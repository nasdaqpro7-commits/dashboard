<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard NASDAQ PRO - Premium Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<meta name="theme-color" content="#050711">
<meta name="mobile-web-app-capable" content="yes">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;600;700;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
:root {
 --sidebar-bg: #0a0d1a;
 --main-bg: #050711;
 --card-bg: #0f1420;
 --card-hover: #161b2e;
 --border: rgba(99,102,241,0.15);
 --border-bright: rgba(99,102,241,0.4);
 --text: #f8fafc;
 --text-dim: #cbd5e1;
 --muted: #64748b;
 --green: #10b981;
 --green-glow: rgba(16,185,129,0.3);
 --red: #ef4444;
 --red-glow: rgba(239,68,68,0.3);
 --yellow: #fbbf24;
 --blue: #6366f1;
 --blue-bright: #818cf8;
 --purple: #a855f7;
 --orange: #f97316;
 --cyan: #06b6d4;
 
 --shadow-sm: 0 2px 8px rgba(0,0,0,0.3);
 --shadow-md: 0 4px 16px rgba(0,0,0,0.4);
 --shadow-lg: 0 8px 32px rgba(0,0,0,0.5);
 --shadow-glow: 0 0 20px rgba(99,102,241,0.4);
}

* {
 margin: 0;
 padding: 0;
 box-sizing: border-box;
}

body {
 font-family: 'Archivo', -apple-system, BlinkMacSystemFont, sans-serif;
 background: var(--main-bg);
 color: var(--text);
 display: flex;
 justify-content: center;
 min-height: 100vh;
 overflow-x: hidden;
 position: relative;
}

body::before {
 content: '';
 position: fixed;
 top: 0;
 left: 0;
 right: 0;
 bottom: 0;
 background: 
  radial-gradient(circle at 20% 50%, rgba(99,102,241,0.08) 0%, transparent 50%),
  radial-gradient(circle at 80% 80%, rgba(168,85,247,0.08) 0%, transparent 50%);
 pointer-events: none;
 z-index: 0;
}

.dashboard-container {
 display: flex;
 max-width: 1800px;
 width: 100%;
 min-height: 100vh;
 position: relative;
 z-index: 1;
}

/* ========== SIDEBAR ========== */
.sidebar {
 width: 280px;
 background: var(--sidebar-bg);
 padding: 32px 20px;
 border-right: 1px solid var(--border);
 overflow-y: auto;
 display: flex;
 flex-direction: column;
 flex-shrink: 0;
 position: relative;
}

.sidebar::before {
 content: '';
 position: absolute;
 top: 0;
 right: 0;
 width: 1px;
 height: 100%;
 background: linear-gradient(180deg, transparent, var(--blue), transparent);
 opacity: 0.5;
}

.logo {
 display: flex;
 align-items: center;
 justify-content: center;
 margin-bottom: 40px;
 padding: 20px;
 background: linear-gradient(135deg, rgba(99,102,241,0.1), rgba(168,85,247,0.1));
 border-radius: 16px;
 border: 1px solid var(--border);
 transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.logo:hover {
 transform: translateY(-2px);
 box-shadow: var(--shadow-glow);
 border-color: var(--border-bright);
}

.logo img {
 max-height: 80px;
 width: auto;
 max-width: 100%;
 filter: drop-shadow(0 4px 12px rgba(99,102,241,0.4));
}

.filters {
 margin-bottom: 24px;
 animation: slideInLeft 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideInLeft {
 from {
  opacity: 0;
  transform: translateX(-20px);
 }
 to {
  opacity: 1;
  transform: translateX(0);
 }
}

.filter-group {
 margin-bottom: 20px;
}

.filter-group label {
 display: block;
 font-size: 12px;
 text-transform: uppercase;
 letter-spacing: 1.5px;
 color: var(--text-dim);
 margin-bottom: 10px;
 font-weight: 700;
}

.filter-group select {
 width: 100%;
 background: var(--card-bg);
 color: var(--text);
 border: 1px solid var(--border);
 padding: 14px 16px;
 border-radius: 12px;
 font-size: 15px;
 font-weight: 600;
 cursor: pointer;
 transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
 font-family: 'JetBrains Mono', monospace;
}

.filter-group select:hover {
 border-color: var(--blue-bright);
 background: var(--card-hover);
 transform: translateY(-1px);
}

.filter-group select:focus {
 outline: none;
 border-color: var(--blue);
 box-shadow: 0 0 0 4px rgba(99,102,241,0.15);
}

.filter-group select:disabled {
 opacity: 0.4;
 cursor: not-allowed;
 transform: none;
}

.stats-sidebar {
 margin-top: 24px;
 padding-top: 24px;
 border-top: 1px solid var(--border);
 animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.3s both;
}

@keyframes fadeIn {
 from { opacity: 0; }
 to { opacity: 1; }
}

.sidebar-stat {
 display: flex;
 justify-content: space-between;
 align-items: center;
 padding: 14px;
 margin-bottom: 10px;
 background: rgba(99,102,241,0.05);
 border-radius: 10px;
 font-size: 14px;
 transition: all 0.2s;
}

.sidebar-stat:hover {
 background: rgba(99,102,241,0.1);
 transform: translateX(4px);
}

.sidebar-stat span:first-child {
 color: var(--text-dim);
 font-weight: 600;
}

.sidebar-stat span:last-child {
 color: var(--text);
 font-weight: 800;
 font-family: 'JetBrains Mono', monospace;
 font-size: 15px;
}

.mode-toggle {
 width: 100%;
 background: linear-gradient(135deg, var(--blue) 0%, var(--purple) 100%);
 color: white;
 border: none;
 padding: 18px 20px;
 border-radius: 14px;
 font-weight: 800;
 font-size: 15px;
 cursor: pointer;
 transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
 display: grid;
 grid-template-columns: 20px 1fr;
 align-items: center;
 justify-items: center;
 gap: 0;
 letter-spacing: 1px;
 position: relative;
 overflow: hidden;
 box-shadow: 0 4px 12px rgba(99,102,241,0.3);
}

.mode-toggle span {
 display: inline-block;
}

.mode-toggle #modeIcon {
 font-size: 18px;
 line-height: 1;
 justify-self: end;
}

.mode-toggle #modeText {
 font-size: 15px;
 font-weight: 800;
 letter-spacing: 1px;
 justify-self: start;
 margin-left: 8px;
}

.mode-toggle::before {
 content: '';
 position: absolute;
 top: 0;
 left: -100%;
 width: 100%;
 height: 100%;
 background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
 transition: left 0.5s;
}

.mode-toggle:hover::before {
 left: 100%;
}

.mode-toggle:hover {
 transform: translateY(-3px);
 box-shadow: 0 12px 28px rgba(99,102,241,0.5);
}

.mode-toggle:active {
 transform: translateY(-1px);
}

.mode-toggle.basic {
 background: linear-gradient(135deg, var(--cyan) 0%, var(--blue) 100%);
}

/* ========== MAIN CONTENT ========== */
.main-content {
 flex: 1;
 padding: 32px 40px;
 overflow-y: auto;
 overflow-x: hidden;
}

.header-main {
 margin-bottom: 36px;
 animation: slideDown 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideDown {
 from {
  opacity: 0;
  transform: translateY(-20px);
 }
 to {
  opacity: 1;
  transform: translateY(0);
 }
}

.header-main h1 {
 font-size: 40px;
 font-weight: 900;
 margin-bottom: 0;
 background: linear-gradient(135deg, var(--text) 0%, var(--blue-bright) 100%);
 -webkit-background-clip: text;
 -webkit-text-fill-color: transparent;
 background-clip: text;
 letter-spacing: -1px;
}

/* ========== KPIs ========== */
.kpis {
 display: grid;
 grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
 gap: 20px;
 margin-bottom: 32px;
 animation: staggerIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes staggerIn {
 from {
  opacity: 0;
  transform: translateY(20px);
 }
 to {
  opacity: 1;
  transform: translateY(0);
 }
}

.kpi {
 background: var(--card-bg);
 padding: 24px;
 border-radius: 16px;
 border: 1px solid var(--border);
 position: relative;
 overflow: hidden;
 transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
 min-height: 110px;
 display: flex;
 flex-direction: column;
 justify-content: space-between;
}

.kpi::before {
 content: '';
 position: absolute;
 top: 0;
 left: 0;
 width: 100%;
 height: 3px;
 transition: height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
 z-index: 0;
 pointer-events: none;
}

.kpi:hover {
 transform: translateY(-4px);
 box-shadow: var(--shadow-lg);
 border-color: var(--border-bright);
}

.kpi:hover::before {
 height: 100%;
 opacity: 0.05;
}

.kpi-dias::before { background: var(--blue); }
.kpi-trades::before { background: var(--purple); }
.kpi-pontos::before { background: var(--green); }
.kpi-acc::before { background: var(--orange); }
.kpi-gains::before { background: var(--green); }
.kpi-stops::before { background: var(--red); }
.kpi-zero::before { background: var(--yellow); }

.kpi span {
 display: block;
 font-size: 12px;
 text-transform: uppercase;
 letter-spacing: 1.5px;
 color: var(--text-dim);
 font-weight: 700;
 margin-bottom: 12px;
 opacity: 0.95;
 position: relative;
 z-index: 1;
}

.kpi strong {
 display: block;
 font-size: 36px;
 font-weight: 900;
 line-height: 1;
 font-family: 'JetBrains Mono', monospace;
 letter-spacing: -1px;
 position: relative;
 z-index: 1;
}

.kpi input {
 background: var(--main-bg);
 color: var(--text);
 border: 2px solid var(--blue);
 border-radius: 10px;
 padding: 12px;
 font-size: 24px;
 font-weight: 800;
 width: 100%;
 margin-top: 8px;
 text-align: center;
 font-family: 'JetBrains Mono', monospace;
 transition: all 0.2s;
 cursor: text;
}

.kpi input:focus {
 outline: none;
 border-color: var(--blue-bright);
 box-shadow: 0 0 0 4px rgba(99,102,241,0.2);
}

.kpi input:hover {
 border-color: var(--blue-bright);
}

.kpi input::placeholder {
 color: var(--muted);
 opacity: 0.5;
}

.contratos-control {
 display: flex;
 align-items: center;
 justify-content: center;
 gap: 12px;
 margin-top: 8px;
 position: relative;
 z-index: 10;
}

.btn-control {
 background: var(--blue);
 color: white;
 border: none;
 border-radius: 8px;
 width: 40px;
 height: 40px;
 font-size: 24px;
 font-weight: 800;
 cursor: pointer;
 transition: all 0.2s;
 display: flex;
 align-items: center;
 justify-content: center;
 pointer-events: auto;
 z-index: 10;
 position: relative;
}

.btn-control:hover {
 background: var(--blue-bright);
 transform: scale(1.1);
 box-shadow: 0 4px 12px rgba(99,102,241,0.5);
}

.btn-control:active {
 transform: scale(0.95);
 box-shadow: 0 2px 6px rgba(99,102,241,0.5);
}

.valor-contratos {
 background: var(--main-bg);
 color: var(--text);
 border: 2px solid var(--blue);
 border-radius: 10px;
 padding: 8px 24px;
 font-size: 28px;
 font-weight: 900;
 font-family: 'JetBrains Mono', monospace;
 min-width: 80px;
 text-align: center;
 user-select: none;
}

/* ========== CHARTS ========== */
.charts {
 display: grid;
 grid-template-columns: 2fr 1fr;
 gap: 20px;
 margin-bottom: 32px;
 animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;
}

@keyframes fadeInUp {
 from {
  opacity: 0;
  transform: translateY(30px);
 }
 to {
  opacity: 1;
  transform: translateY(0);
 }
}

.chart-card {
 background: var(--card-bg);
 padding: 28px;
 border-radius: 16px;
 border: 1px solid var(--border);
 display: flex;
 flex-direction: column;
 height: 460px;
 transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
 position: relative;
 overflow: hidden;
}

.chart-card::after {
 content: '';
 position: absolute;
 top: -50%;
 left: -50%;
 width: 200%;
 height: 200%;
 background: radial-gradient(circle, rgba(99,102,241,0.03) 0%, transparent 70%);
 opacity: 0;
 transition: opacity 0.5s;
}

.chart-card:hover::after {
 opacity: 1;
}

.chart-card:hover {
 border-color: var(--border-bright);
 box-shadow: var(--shadow-md);
}

.chart-card h3 {
 font-size: 18px;
 margin-bottom: 20px;
 font-weight: 700;
 display: flex;
 align-items: center;
 gap: 10px;
 color: var(--text-dim);
 letter-spacing: -0.5px;
 position: relative;
 z-index: 1;
}

.chart-wrap {
 flex: 1;
 position: relative;
 min-height: 0;
 z-index: 1;
}

canvas {
 width: 100% !important;
 height: 100% !important;
}

/* ========== CALENDAR ========== */
.calendar-wrapper {
 margin-bottom: 32px;
 background: var(--card-bg);
 border: 1px solid var(--border);
 border-radius: 16px;
 padding: 24px;
 animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.3s both;
 transition: all 0.3s;
}

.calendar-wrapper:hover {
 border-color: var(--border-bright);
}

.calendar-wrapper > strong {
 display: block;
 margin-bottom: 24px;
 font-size: 18px;
 font-weight: 700;
 color: var(--text-dim);
}

#calendarTitle {
 display: flex;
 align-items: center;
 justify-content: space-between;
 gap: 12px;
}

#calendarTitle span {
 flex: 1;
 text-align: center;
}

.back-to-months-btn {
 background: var(--blue);
 color: white;
 border: none;
 border-radius: 8px;
 padding: 8px 16px;
 font-size: 13px;
 font-weight: 700;
 cursor: pointer;
 transition: all 0.2s;
 display: flex;
 align-items: center;
 gap: 6px;
 white-space: nowrap;
}

.back-to-months-btn:hover {
 background: var(--blue-bright);
 transform: translateX(-3px);
}

.back-to-months-btn:active {
 transform: translateX(-1px);
}

.calendar-header {
 display: grid;
 grid-template-columns: repeat(7, 1fr);
 margin-bottom: 16px;
 text-align: center;
 color: var(--text-dim);
 font-size: 14px;
 font-weight: 800;
 text-transform: uppercase;
 letter-spacing: 1.5px;
}

.calendar-grid {
 display: grid;
 grid-template-columns: repeat(7, 1fr);
 gap: 8px;
}

.calendar-grid:has(.month-card) {
 grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
 gap: 12px;
}

/* Month Cards (quando "Todos os meses" est√° selecionado) */
.month-card {
 background: linear-gradient(135deg, rgba(15,20,32,0.8), var(--card-bg));
 border: 2px solid var(--border);
 border-radius: 12px;
 padding: 16px;
 cursor: pointer;
 transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
 display: flex;
 flex-direction: column;
 align-items: center;
 justify-content: center;
 gap: 8px;
 min-height: 100px;
}

.month-card:hover {
 transform: translateY(-4px) scale(1.02);
 box-shadow: var(--shadow-lg);
 border-color: var(--blue-bright);
}

.month-card.positive {
 background: linear-gradient(135deg, rgba(16,185,129,0.1), var(--card-bg));
 border-color: rgba(16,185,129,0.4);
}

.month-card.positive:hover {
 box-shadow: 0 8px 32px var(--green-glow);
 border-color: var(--green);
}

.month-card.negative {
 background: linear-gradient(135deg, rgba(239,68,68,0.1), var(--card-bg));
 border-color: rgba(239,68,68,0.4);
}

.month-card.negative:hover {
 box-shadow: 0 8px 32px var(--red-glow);
 border-color: var(--red);
}

.month-name {
 font-size: 14px;
 font-weight: 800;
 color: var(--text);
 text-transform: uppercase;
 letter-spacing: 0.5px;
}

.month-points {
 font-size: 32px;
 font-weight: 900;
 font-family: 'JetBrains Mono', monospace;
 line-height: 1;
}

.month-info {
 font-size: 11px;
 color: var(--text-dim);
 font-weight: 600;
}

.day {
 position: relative;
 background: linear-gradient(135deg, rgba(15,20,32,0.8), var(--card-bg));
 border: 1px solid var(--border);
 border-radius: 10px;
 min-height: 75px;
 padding: 6px;
 padding-bottom: 26px;
 display: flex;
 flex-direction: column;
 justify-content: flex-start;
 gap: 2px;
 transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
 cursor: default;
}

.day.clickable {
 cursor: pointer;
}

.day.clickable::after {
 content: 'üì∏';
 position: absolute;
 top: 6px;
 right: 6px;
 font-size: 12px;
 opacity: 0;
 transition: opacity 0.3s;
}

.day.clickable:hover::after {
 opacity: 0.7;
}

.day.positive {
 background: linear-gradient(135deg, rgba(16,185,129,0.08), var(--card-bg));
 border-color: rgba(16,185,129,0.3);
}

.day.negative {
 background: linear-gradient(135deg, rgba(239,68,68,0.08), var(--card-bg));
 border-color: rgba(239,68,68,0.3);
}

.day:hover:not(.empty) {
 transform: translateY(-4px) scale(1.02);
 box-shadow: var(--shadow-lg);
 border-color: var(--blue-bright);
 z-index: 10;
}

.day.positive:hover {
 box-shadow: 0 8px 32px var(--green-glow);
}

.day.negative:hover {
 box-shadow: 0 8px 32px var(--red-glow);
}

.day-number {
 font-size: 11px;
 color: var(--muted);
 font-weight: 700;
 font-family: 'JetBrains Mono', monospace;
}

.day-points {
 display: flex;
 align-items: center;
 justify-content: center;
 font-size: 22px;
 font-weight: 900;
 font-family: 'JetBrains Mono', monospace;
 margin-top: 1px;
 margin-bottom: 4px;
}

.day-info {
 font-size: 10px;
 color: var(--text-dim);
 text-align: center;
 line-height: 1.4;
 font-weight: 600;
}

.day-badge {
 position: absolute;
 bottom: 4px;
 left: 50%;
 transform: translateX(-50%);
 background: rgba(0,0,0,0.95);
 backdrop-filter: blur(10px);
 border: 1px solid var(--border-bright);
 border-radius: 6px;
 padding: 4px 8px;
 font-size: 9px;
 white-space: nowrap;
 opacity: 0;
 transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
 font-weight: 700;
 font-family: 'JetBrains Mono', monospace;
 letter-spacing: 0.3px;
 z-index: 100;
 pointer-events: none;
}

.day:hover .day-badge {
 opacity: 1;
}

.empty {
 background: transparent;
 border: none;
 cursor: default;
}

/* ========== TABLE ========== */
.table-card {
 background: var(--card-bg);
 border: 1px solid var(--border);
 border-radius: 16px;
 padding: 28px;
 margin-bottom: 32px;
 animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.4s both;
 transition: all 0.3s;
}

.table-card:hover {
 border-color: var(--border-bright);
}

.table-card > strong {
 display: block;
 margin-bottom: 24px;
 font-size: 18px;
 font-weight: 700;
 color: var(--text-dim);
}

.table-wrap {
 overflow-x: auto;
 border-radius: 12px;
}

table {
 width: 100%;
 min-width: 900px;
 border-collapse: separate;
 border-spacing: 0;
}

thead {
 background: linear-gradient(135deg, rgba(99,102,241,0.1), rgba(168,85,247,0.1));
}

th {
 color: var(--blue-bright);
 font-weight: 700;
 font-size: 13px;
 padding: 18px 14px;
 text-align: center;
 text-transform: uppercase;
 letter-spacing: 1.5px;
 border-bottom: 2px solid var(--border-bright);
}

td {
 padding: 16px 14px;
 border-bottom: 1px solid var(--border);
 text-align: center;
 font-size: 14px;
 font-weight: 600;
 font-family: 'JetBrains Mono', monospace;
}

thead th:first-child,
tbody td:first-child {
 text-align: left;
 padding-left: 20px;
 font-family: 'Archivo', sans-serif;
}

tr.total {
 background: linear-gradient(135deg, rgba(16,185,129,0.08), rgba(99,102,241,0.08));
 font-weight: 800;
}

tr.total td {
 border-bottom: none;
 padding: 20px 14px;
 font-size: 15px;
}

tbody tr {
 transition: all 0.2s;
}

tbody tr:hover {
 background: rgba(99,102,241,0.08);
 transform: scale(1.01);
}

/* ========== MODO B√ÅSICO ========== */
body.basic-mode .pro-only {
 display: none !important;
}

/* ========== LOADING ========== */
.loading-overlay {
 position: fixed;
 top: 0;
 left: 0;
 right: 0;
 bottom: 0;
 background: var(--main-bg);
 display: flex;
 flex-direction: column;
 align-items: center;
 justify-content: center;
 z-index: 9999;
 opacity: 1;
 transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.loading-overlay.hidden {
 opacity: 0;
 pointer-events: none;
}

.spinner {
 width: 70px;
 height: 70px;
 border: 4px solid var(--border);
 border-top-color: var(--blue);
 border-bottom-color: var(--purple);
 border-radius: 50%;
 animation: spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
 margin-bottom: 24px;
}

@keyframes spin {
 to { transform: rotate(360deg); }
}

.loading-text {
 color: var(--text-dim);
 font-size: 14px;
 font-weight: 600;
 letter-spacing: 2px;
 text-transform: uppercase;
 animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
 0%, 100% { opacity: 0.5; }
 50% { opacity: 1; }
}

/* ========== PERFORMANCE INDICATOR ========== */
.performance-indicator {
 position: fixed;
 top: 20px;
 right: 20px;
 background: var(--card-bg);
 border: 1px solid var(--border);
 border-radius: 12px;
 padding: 12px 16px;
 display: flex;
 align-items: center;
 gap: 10px;
 font-size: 13px;
 font-weight: 700;
 z-index: 100;
 opacity: 0;
 animation: slideInRight 0.5s cubic-bezier(0.4, 0, 0.2, 1) 1s forwards;
 box-shadow: var(--shadow-md);
}

@keyframes slideInRight {
 from {
  opacity: 0;
  transform: translateX(100px);
 }
 to {
  opacity: 1;
  transform: translateX(0);
 }
}

.performance-dot {
 width: 10px;
 height: 10px;
 border-radius: 50%;
 animation: glow 2s ease-in-out infinite;
}

.performance-dot.positive { background: var(--green); }
.performance-dot.negative { background: var(--red); }
.performance-dot.neutral { background: var(--yellow); }

@keyframes glow {
 0%, 100% { box-shadow: 0 0 5px currentColor; }
 50% { box-shadow: 0 0 20px currentColor; }
}

/* ========== MODAL DE FOTO DO TRADE ========== */
.trade-photo-modal {
 position: fixed;
 top: 0;
 left: 0;
 right: 0;
 bottom: 0;
 background: rgba(0, 0, 0, 0.95);
 display: none;
 align-items: center;
 justify-content: center;
 z-index: 10000;
 padding: 20px;
 backdrop-filter: blur(10px);
 animation: fadeIn 0.3s ease-out;
}

.trade-photo-modal.active {
 display: flex;
}

.modal-content {
 background: var(--card-bg);
 border: 2px solid var(--border-bright);
 border-radius: 20px;
 max-width: 650px;
 width: 100%;
 max-height: 85vh;
 overflow-y: auto;
 position: relative;
 box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
 animation: slideInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideInUp {
 from {
  opacity: 0;
  transform: translateY(50px) scale(0.9);
 }
 to {
  opacity: 1;
  transform: translateY(0) scale(1);
 }
}

.modal-header {
 padding: 18px 20px;
 border-bottom: 1px solid var(--border);
 display: flex;
 align-items: center;
 justify-content: space-between;
}

.modal-header h2 {
 font-size: 20px;
 font-weight: 800;
 color: var(--text);
 display: flex;
 align-items: center;
 gap: 10px;
}

.modal-close-btn {
 background: var(--red);
 color: white;
 border: none;
 border-radius: 50%;
 width: 36px;
 height: 36px;
 font-size: 22px;
 font-weight: 800;
 cursor: pointer;
 transition: all 0.2s;
 display: flex;
 align-items: center;
 justify-content: center;
 line-height: 1;
}

.modal-close-btn:hover {
 background: #dc2626;
 transform: rotate(90deg) scale(1.1);
}

.modal-body {
 padding: 20px;
}

.modal-info-grid {
 display: grid;
 grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
 gap: 12px;
 margin-bottom: 20px;
}

.modal-info-item {
 background: rgba(99, 102, 241, 0.05);
 border: 1px solid var(--border);
 border-radius: 10px;
 padding: 12px;
 text-align: center;
}

.modal-info-item label {
 display: block;
 font-size: 11px;
 text-transform: uppercase;
 letter-spacing: 0.5px;
 color: var(--text-dim);
 margin-bottom: 6px;
 font-weight: 700;
}

.modal-info-item .value {
 font-size: 22px;
 font-weight: 900;
 font-family: 'JetBrains Mono', monospace;
 color: var(--text);
}

.modal-info-item.positive .value {
 color: var(--green);
}

.modal-info-item.negative .value {
 color: var(--red);
}

.modal-photo-container {
 background: var(--main-bg);
 border: 2px solid var(--border);
 border-radius: 12px;
 padding: 12px;
 margin-top: 20px;
 position: relative;
 overflow: hidden;
 cursor: grab;
}

.modal-photo-container.grabbing {
 cursor: grabbing;
}

.modal-photo-container img {
 width: 100%;
 height: auto;
 max-height: 400px;
 object-fit: contain;
 border-radius: 8px;
 display: block;
 transition: transform 0.1s ease-out;
 transform-origin: center center;
}

.zoom-controls {
 position: absolute;
 top: 16px;
 right: 16px;
 display: flex;
 gap: 8px;
 z-index: 10;
}

.zoom-btn {
 background: rgba(0, 0, 0, 0.7);
 color: white;
 border: 1px solid rgba(255, 255, 255, 0.2);
 border-radius: 8px;
 width: 36px;
 height: 36px;
 font-size: 18px;
 font-weight: 700;
 cursor: pointer;
 transition: all 0.2s;
 display: flex;
 align-items: center;
 justify-content: center;
 backdrop-filter: blur(10px);
}

.zoom-btn:hover {
 background: rgba(0, 0, 0, 0.9);
 transform: scale(1.1);
}

.zoom-btn:active {
 transform: scale(0.95);
}

.zoom-info {
 position: absolute;
 bottom: 16px;
 left: 50%;
 transform: translateX(-50%);
 background: rgba(0, 0, 0, 0.7);
 color: white;
 padding: 6px 12px;
 border-radius: 6px;
 font-size: 12px;
 font-weight: 600;
 backdrop-filter: blur(10px);
 pointer-events: none;
 opacity: 0;
 transition: opacity 0.3s;
}

.zoom-info.show {
 opacity: 1;
}

.modal-photo-loading {
 text-align: center;
 padding: 40px 20px;
 color: var(--text-dim);
 font-size: 14px;
 font-weight: 600;
}

.modal-photo-error {
 text-align: center;
 padding: 40px 20px;
 color: var(--red);
 font-size: 14px;
 font-weight: 600;
}

.modal-photo-spinner {
 width: 40px;
 height: 40px;
 border: 3px solid var(--border);
 border-top-color: var(--blue);
 border-radius: 50%;
 animation: spin 1s linear infinite;
 margin: 0 auto 16px;
}

.currency-display {
 display: flex;
 align-items: center;
 justify-content: center;
 gap: 8px;
 margin-top: 12px;
 padding: 8px 16px;
 background: rgba(99, 102, 241, 0.08);
 border-radius: 8px;
 border: 1px solid rgba(99, 102, 241, 0.15);
}

.currency-icon {
 font-size: 18px;
 filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
}

.currency-value-brl {
 font-size: 15px;
 font-weight: 800;
 font-family: 'JetBrains Mono', monospace;
 color: var(--text);
 letter-spacing: 0.5px;
}

/* Remove CSS antigo do conversor */
::-webkit-scrollbar {
 width: 8px;
 height: 8px;
}

::-webkit-scrollbar-track {
 background: var(--main-bg);
}

::-webkit-scrollbar-thumb {
 background: var(--border-bright);
 border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
 background: var(--blue);
}

/* ========== RESPONSIVE ========== */
@media (max-width: 1200px) {
 .charts {
  grid-template-columns: 1fr;
 }
}

@media (max-width: 1024px) {
 .dashboard-container {
  flex-direction: column;
 }
 
 .sidebar {
  width: 100%;
  border-right: none;
  border-bottom: 1px solid var(--border);
  padding: 20px 16px;
 }
 
 .sidebar::before {
  width: 100%;
  height: 1px;
  top: auto;
  bottom: 0;
  background: linear-gradient(90deg, transparent, var(--blue), transparent);
 }
 
 .logo {
  margin-bottom: 20px;
  padding: 16px;
 }
 
 .logo img {
  max-height: 60px;
 }
 
 .filters {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-bottom: 16px;
 }
 
 .filter-group {
  margin-bottom: 0;
 }
 
 .filter-group label {
  font-size: 11px;
  margin-bottom: 6px;
 }
 
 .filter-group select {
  padding: 10px 12px;
  font-size: 13px;
 }
 
 .stats-sidebar {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-top: 16px;
  padding-top: 16px;
 }
 
 .sidebar-stat {
  margin-bottom: 0;
  padding: 10px;
  font-size: 12px;
 }
 
 .sidebar-stat span:last-child {
  font-size: 13px;
 }
 
 .mode-toggle {
  padding: 14px 16px;
  font-size: 13px;
  margin-top: 16px;
 }
 
 .mode-toggle #modeText {
  font-size: 13px;
 }
 
 .mode-toggle #modeIcon {
  font-size: 16px;
 }
 
 .main-content {
  padding: 20px 16px;
 }
 
 .header-main {
  margin-bottom: 24px;
 }
 
 .header-main h1 {
  font-size: 28px;
 }
 
 .performance-indicator {
  top: 12px;
  right: 12px;
  font-size: 11px;
  padding: 8px 12px;
 }
}

@media (max-width: 768px) {
 .kpis {
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
 }
 
 .kpi {
  min-height: 90px;
  padding: 16px;
 }
 
 .kpi span {
  font-size: 10px;
  margin-bottom: 8px;
 }
 
 .kpi strong {
  font-size: 28px;
 }
 
 .calendar-grid {
  gap: 6px;
 }
 
 .day {
  min-height: 70px;
  padding: 6px;
  padding-bottom: 24px;
  border-radius: 10px;
 }
 
 .day-number {
  font-size: 11px;
 }
 
 .day-points {
  font-size: 20px;
  margin-top: 1px;
  margin-bottom: 3px;
 }
 
 .day-info {
  font-size: 9px;
  line-height: 1.3;
 }
 
 .day-badge {
  font-size: 8px;
  padding: 3px 6px;
  bottom: 3px;
 }
 
 .chart-card {
  height: 300px;
  padding: 20px;
 }
 
 .chart-card h3 {
  font-size: 16px;
  margin-bottom: 16px;
 }
 
 .calendar-wrapper {
  padding: 16px;
 }
 
 .calendar-wrapper > strong,
 #calendarTitle {
  font-size: 16px;
  margin-bottom: 16px;
 }
 
 .calendar-header {
  font-size: 12px;
  margin-bottom: 12px;
 }
 
 .back-to-months-btn {
  font-size: 12px;
  padding: 6px 12px;
 }
 
 .month-card {
  min-height: 90px;
  padding: 14px;
  gap: 6px;
 }
 
 .month-name {
  font-size: 13px;
 }
 
 .month-points {
  font-size: 28px;
 }
 
 .month-info {
  font-size: 10px;
 }
 
 .table-card {
  padding: 20px 16px;
 }
 
 .table-card > strong {
  font-size: 16px;
  margin-bottom: 16px;
 }
 
 table {
  min-width: 700px;
 }
 
 th {
  font-size: 11px;
  padding: 12px 10px;
 }
 
 td {
  font-size: 12px;
  padding: 12px 10px;
 }
 
 /* Modal menor em mobile */
 .modal-content {
  max-width: 95%;
  max-height: 90vh;
 }
 
 .modal-header {
  padding: 14px 16px;
 }
 
 .modal-header h2 {
  font-size: 16px;
  gap: 8px;
 }
 
 .modal-close-btn {
  width: 32px;
  height: 32px;
  font-size: 20px;
 }
 
 .modal-body {
  padding: 16px;
 }
 
 .modal-info-grid {
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  margin-bottom: 16px;
 }
 
 .modal-info-item {
  padding: 10px;
 }
 
 .modal-info-item label {
  font-size: 10px;
  margin-bottom: 4px;
 }
 
 .modal-info-item .value {
  font-size: 18px;
 }
 
 .modal-photo-container {
  padding: 10px;
  margin-top: 16px;
 }
 
 .modal-photo-container img {
  max-height: 300px;
 }
 
 .modal-photo-loading,
 .modal-photo-error {
  padding: 30px 16px;
  font-size: 13px;
 }
 
 .modal-photo-spinner {
  width: 35px;
  height: 35px;
  margin-bottom: 12px;
 }
 
 .currency-display {
  padding: 6px 12px;
  margin-top: 10px;
  gap: 6px;
 }
 
 .currency-icon {
  font-size: 16px;
 }
 
 .currency-value-brl {
  font-size: 13px;
 }
}

@media (max-width: 480px) {
 .kpis {
  grid-template-columns: 1fr;
  gap: 10px;
 }
 
 .kpi {
  min-height: 80px;
  padding: 14px;
 }
 
 .header-main h1 {
  font-size: 24px;
 }
 
 .performance-indicator {
  position: relative;
  top: 0;
  right: 0;
  margin-bottom: 16px;
  justify-content: flex-start;
 }
 
 .filters {
  grid-template-columns: 1fr;
  gap: 10px;
 }
 
 .stats-sidebar {
  grid-template-columns: 1fr;
  gap: 8px;
 }
 
 .day {
  min-height: 65px;
  padding: 5px;
  padding-bottom: 20px;
 }
 
 .day-points {
  font-size: 18px;
 }
 
 .day-info {
  font-size: 8px;
 }
 
 .calendar-header {
  font-size: 11px;
 }
 
 .chart-card {
  height: 250px;
  padding: 16px;
 }
 
 .chart-card h3 {
  font-size: 14px;
  margin-bottom: 12px;
 }
 
 .modal-content {
  max-width: 98%;
  border-radius: 16px;
 }
 
 .modal-header h2 {
  font-size: 14px;
 }
 
 .modal-info-grid {
  grid-template-columns: 1fr;
  gap: 8px;
 }
 
 .modal-photo-container img {
  max-height: 250px;
 }
 
 .contratos-control {
  gap: 8px;
 }
 
 .btn-control {
  width: 36px;
  height: 36px;
  font-size: 20px;
 }
 
 .valor-contratos {
  font-size: 24px;
  padding: 6px 18px;
  min-width: 70px;
 }
}

/* ========== TOOLTIP ========== */
.tooltip {
 position: absolute;
 background: rgba(0,0,0,0.95);
 color: var(--text);
 padding: 12px 16px;
 border-radius: 8px;
 font-size: 12px;
 font-weight: 600;
 pointer-events: none;
 opacity: 0;
 transition: opacity 0.2s;
 z-index: 1000;
 border: 1px solid var(--border-bright);
 backdrop-filter: blur(10px);
 white-space: nowrap;
}

.tooltip.show {
 opacity: 1;
}
</style>
</head>
<body>

<div class="loading-overlay" id="loading">
 <div class="spinner"></div>
 <div class="loading-text">Carregando Dashboard...</div>
</div>

<div class="performance-indicator" id="perfIndicator" style="display: none;">
 <div class="performance-dot neutral"></div>
 <span id="perfText">Carregando...</span>
</div>

<div class="dashboard-container">
<!-- SIDEBAR -->
<div class="sidebar">
 <div class="logo">
  <img src="logo.png" alt="Mentoria NasdaqPro" onerror="this.style.display='none'">
 </div>
 
 <div class="filters">
  <div class="filter-group">
   <label>üìÖ Ano</label>
   <select id="filtroAno"></select>
  </div>
  <div class="filter-group">
   <label>üìÜ M√™s</label>
   <select id="filtroMes"></select>
  </div>
  <div class="filter-group">
   <label>üìä Semana</label>
   <select id="filtroSemana"></select>
  </div>
 </div>
 
 <button class="mode-toggle basic" id="toggleMode">
  <span id="modeIcon">üìä</span>
  <span id="modeText">Modo B√°sico</span>
 </button>
 
 <div class="stats-sidebar">
  <div class="sidebar-stat">
   <span>Assertividade</span>
   <span id="sidebarWinRate">0%</span>
  </div>
  <div class="sidebar-stat">
   <span>Melhor Dia</span>
   <span id="sidebarBestDay">0</span>
  </div>
  <div class="sidebar-stat">
   <span>Pior Dia</span>
   <span id="sidebarWorstDay">0</span>
  </div>
 </div>
</div>

<!-- MAIN CONTENT -->
<div class="main-content">
 <div class="header-main">
  <h1>Dashboard de Trading</h1>
 </div>
 
 <div class="kpis">
  <div class="kpi kpi-dias">
   <span>Dias Operados</span>
   <strong id="kDias">0</strong>
  </div>
  <div class="kpi kpi-trades">
   <span>Total de Trades</span>
   <strong id="kTrades">0</strong>
  </div>
  <div class="kpi kpi-pontos">
   <span>Pontos Totais</span>
   <strong id="kPontos">0</strong>
  </div>
  <div class="kpi kpi-acc">
   <span>Assertividade</span>
   <strong id="kAcc">0%</strong>
  </div>
  <div class="kpi kpi-gains pro-only">
   <span>Gains</span>
   <strong id="kGains" style="color:var(--green)">0</strong>
  </div>
  <div class="kpi kpi-stops pro-only">
   <span>Stops</span>
   <strong id="kStops" style="color:var(--red)">0</strong>
  </div>
  <div class="kpi kpi-zero pro-only">
   <span>Breakeven (0x0)</span>
   <strong id="kZero" style="color:var(--yellow)">0</strong>
  </div>
  <div class="kpi pro-only">
   <span>Contratos por Trade</span>
   <div class="contratos-control">
    <button id="btnMenos" class="btn-control">-</button>
    <div id="valorContratos" class="valor-contratos">0</div>
    <button id="btnMais" class="btn-control">+</button>
   </div>
  </div>
  <div class="kpi pro-only">
   <span>Total em D√≥lar</span>
   <strong id="kDolar" style="color:var(--green)">$0.00</strong>
   <div class="currency-display">
    <span class="currency-icon">üáßüá∑</span>
    <span class="currency-value-brl" id="valorBRL">R$ 0,00</span>
   </div>
  </div>
 </div>
 
 <div class="charts pro-only">
  <div class="chart-card">
   <h3>üìà Evolu√ß√£o de Performance</h3>
   <div class="chart-wrap">
    <canvas id="chartAcumulado"></canvas>
   </div>
  </div>
  <div class="chart-card">
   <h3>üìä Distribui√ß√£o de Resultados</h3>
   <div class="chart-wrap">
    <canvas id="chartBar"></canvas>
   </div>
  </div>
 </div>
 
 <div class="calendar-wrapper pro-only">
  <strong id="calendarTitle">üìÖ Calend√°rio de Trading</strong>
  <div class="calendar-header">
   <div>Dom</div><div>Seg</div><div>Ter</div>
   <div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div>
  </div>
  <div class="calendar-grid" id="calendar"></div>
 </div>
 
 <div class="table-card">
  <strong>üìã Hist√≥rico Detalhado de Opera√ß√µes</strong>
  <div class="table-wrap">
   <table>
    <thead>
     <tr>
      <th>Data</th><th>Pontos</th><th>Trades</th>
      <th>Gain</th><th>Stop</th><th>0x0</th>
      <th>Ativo</th><th>Semana</th>
     </tr>
    </thead>
    <tbody id="tbody"></tbody>
   </table>
  </div>
 </div>
</div>
</div>

<!-- MODAL DE FOTO DO TRADE -->
<div class="trade-photo-modal" id="tradePhotoModal">
 <div class="modal-content">
  <div class="modal-header">
   <h2 id="modalTitle">üìÖ Carregando...</h2>
   <button class="modal-close-btn" onclick="Dashboard.fecharModal()">√ó</button>
  </div>
  <div class="modal-body">
   <div class="modal-info-grid" id="modalInfoGrid"></div>
   <div class="modal-photo-container" id="modalPhotoContainer">
    <div class="modal-photo-loading">
     <div class="modal-photo-spinner"></div>
     Carregando foto...
    </div>
   </div>
  </div>
 </div>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTbyybCny81vfVXQHmtlkKEOHHJ6xJ_pKSG_4ndkK0tH-YocrFeWY7qL41TS1IfvRQjLSbLIILV56OV/pub?output=csv";
const GOOGLE_DRIVE_FOLDER_ID = "13wSi9sB3nDbQcF0oYDF1ZxWtLVNNrroh";
const nomesMeses = {
 "01":"Janeiro","02":"Fevereiro","03":"Mar√ßo","04":"Abril",
 "05":"Maio","06":"Junho","07":"Julho","08":"Agosto",
 "09":"Setembro","10":"Outubro","11":"Novembro","12":"Dezembro"
};

const Dashboard = {
 dados: [],
 primeiraCarga: true,
 chartAcumulado: null,
 chartBar: null,
 cotacaoUSDtoBRL: 5.50,
 valorTotalUSD: 0,
 zoomLevel: 1,
 zoomPosX: 0,
 zoomPosY: 0,
 isDragging: false,
 startX: 0,
 startY: 0,
 
 async init() {
  this.inicializarToggleMode();
  await this.carregarDados();
  this.atualizarPerformanceIndicator();
  this.inicializarConversorMoeda();
 },
 
 async carregarDados() {
  try {
   const response = await fetch(CSV_URL);
   if (!response.ok) throw new Error('Erro ao carregar dados');
   const texto = await response.text();
   this.processarCSV(texto);
   
   setTimeout(() => {
    document.getElementById('loading').classList.add('hidden');
   }, 500);
  } catch (erro) {
   console.error('Erro:', erro);
   alert('Erro ao carregar dados. Por favor, tente novamente.');
   document.getElementById('loading').classList.add('hidden');
  }
 },
 
 processarCSV(texto) {
  const linhas = texto.trim().split(/\r?\n/);
  linhas.shift();
  
  this.dados = linhas.map(linha => {
   const cols = linha.split(",");
   const [d, m, a] = cols[0].split("/");
   return {
    dia: cols[0],
    data: new Date(a, m-1, d),
    semana: cols[1],
    ativo: cols[2],
    ano: a,
    mes: m,
    pontos: +cols[3] || 0,
    trades: +cols[4] || 0,
    gain: +cols[5] || 0,
    stop: +cols[6] || 0,
    zero: +cols[7] || 0,
    fotoId: cols[8] || "" // Coluna 8: ID da foto do Google Drive
   };
  }).filter(Boolean);
  
  this.inicializarFiltros();
  
  setTimeout(() => {
   this.inicializarCalculadora();
  }, 100);
 },
 
 inicializarFiltros() {
  const anos = [...new Set(this.dados.map(d => d.ano))].sort();
  filtroAno.innerHTML = anos.map(a => `<option value="${a}">${a}</option>`).join("");
  
  const anoAtual = new Date().getFullYear().toString();
  filtroAno.value = anos.includes(anoAtual) ? anoAtual : anos[anos.length-1];
  
  filtroAno.onchange = () => {
   this.primeiraCarga = false;
   this.inicializarMeses();
   this.atualizar();
  };
  
  this.inicializarMeses();
 },
 
 inicializarMeses() {
  const meses = [...new Set(this.dados.filter(d => d.ano === filtroAno.value).map(d => d.mes))];
  filtroMes.innerHTML = '<option value="ALL">Todos os meses</option>' +
   meses.map(m => `<option value="${m}">${nomesMeses[m]}</option>`).join("");
  
  const mesAtual = (new Date().getMonth()+1).toString().padStart(2,"0");
  
  // Na primeira carga, seleciona o m√™s atual (n√£o "Todos os meses")
  if (this.primeiraCarga && meses.includes(mesAtual)) {
   filtroMes.value = mesAtual;
   filtroSemana.disabled = false;
  } else if (!this.primeiraCarga) {
   filtroMes.value = "ALL";
   filtroSemana.disabled = true;
  }
  
  filtroMes.onchange = () => {
   this.primeiraCarga = false;
   
   if (filtroMes.value === "ALL") {
    filtroSemana.disabled = true;
    filtroSemana.value = "ALL";
   } else {
    filtroSemana.disabled = false;
   }
   
   this.inicializarSemanas();
   this.atualizar();
  };
  
  if (filtroMes.value === "ALL") {
   filtroSemana.disabled = true;
  }
  
  this.inicializarSemanas();
 },
 
 inicializarSemanas() {
  const semanas = [...new Set(
   this.dados.filter(d =>
    d.ano === filtroAno.value &&
    (filtroMes.value === "ALL" || d.mes === filtroMes.value)
   ).map(d => d.semana)
  )].sort((a,b) => a-b);
  
  filtroSemana.innerHTML = '<option value="ALL">Todas as semanas</option>' +
   semanas.map(s => `<option value="${s}">${s}</option>`).join("");
  
  // Na primeira carga, sempre deixa em "Todas as semanas" para mostrar o m√™s completo
  filtroSemana.value = "ALL";
  
  filtroSemana.onchange = () => {
   this.primeiraCarga = false;
   this.atualizar();
  };
  
  this.atualizar();
 },
 
 inicializarCalculadora() {
  setTimeout(() => {
   const btnMais = document.getElementById('btnMais');
   const btnMenos = document.getElementById('btnMenos');
   const valorDiv = document.getElementById('valorContratos');
   
   if (!btnMais || !btnMenos || !valorDiv) {
    return;
   }
   
   let valor = 0;
   
   btnMais.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    valor++;
    valorDiv.textContent = valor;
    Dashboard.atualizar();
   });
   
   btnMenos.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    if (valor > 0) {
     valor--;
     valorDiv.textContent = valor;
     Dashboard.atualizar();
    }
   });
  }, 500);
 },
 
 inicializarToggleMode() {
  const toggleBtn = document.getElementById('toggleMode');
  const modeIcon = document.getElementById('modeIcon');
  const modeText = document.getElementById('modeText');
  let isProMode = false;
  
  document.body.classList.add('basic-mode');
  toggleBtn.classList.remove('pro');
  toggleBtn.classList.add('basic');
  modeIcon.textContent = 'üìä';
  modeText.textContent = 'Modo B√°sico';
  
  if (toggleBtn) {
   toggleBtn.addEventListener('click', () => {
    isProMode = !isProMode;
    
    if (isProMode) {
     document.body.classList.remove('basic-mode');
     toggleBtn.classList.add('pro');
     toggleBtn.classList.remove('basic');
     modeIcon.textContent = '‚ö°';
     modeText.textContent = 'Modo Pro';
     
     setTimeout(() => {
      this.inicializarCalculadora();
     }, 100);
    } else {
     document.body.classList.add('basic-mode');
     toggleBtn.classList.remove('pro');
     toggleBtn.classList.add('basic');
     modeIcon.textContent = 'üìä';
     modeText.textContent = 'Modo B√°sico';
    }
   });
  }
 },
 
 obterDadosFiltrados() {
  return this.dados.filter(d =>
   d.ano === filtroAno.value &&
   (filtroMes.value === "ALL" || d.mes === filtroMes.value) &&
   (filtroSemana.value === "ALL" || d.semana === filtroSemana.value)
  );
 },
 
 atualizar() {
  const dadosFiltrados = this.obterDadosFiltrados();
  this.renderizarKPIs(dadosFiltrados);
  this.renderizarTabela(dadosFiltrados);
  this.renderizarGraficos(dadosFiltrados);
  this.renderizarCalendario(dadosFiltrados);
  this.atualizarSidebarStats(dadosFiltrados);
  this.atualizarPerformanceIndicator(dadosFiltrados);
 },
 
 renderizarKPIs(dados) {
  const totais = dados.reduce((acc, d) => ({
   trades: acc.trades + d.trades,
   pontos: acc.pontos + d.pontos,
   gain: acc.gain + d.gain,
   stop: acc.stop + d.stop,
   zero: acc.zero + d.zero
  }), { trades: 0, pontos: 0, gain: 0, stop: 0, zero: 0 });
  
  const operacoes = totais.gain + totais.stop;
  const assertividade = operacoes ? Math.round((totais.gain / operacoes) * 100) : 0;
  const diasOperados = dados.filter(d => d.trades > 0).length;
  
  const valorContratosDiv = document.getElementById('valorContratos');
  const contratos = valorContratosDiv ? parseInt(valorContratosDiv.textContent) || 0 : 0;
  const totalDolar = totais.pontos * contratos * 2;
  
  document.getElementById("kDias").textContent = diasOperados;
  document.getElementById("kTrades").textContent = totais.trades;
  document.getElementById("kPontos").textContent = totais.pontos;
  document.getElementById("kAcc").textContent = assertividade + "%";
  
  const kDolar = document.getElementById("kDolar");
  if (kDolar) {
   kDolar.textContent = totalDolar.toLocaleString('en-US', {style: 'currency', currency: 'USD'});
   kDolar.style.color = totalDolar >= 0 ? 'var(--green)' : 'var(--red)';
   
   // Atualiza valor em Real
   this.valorTotalUSD = totalDolar;
   this.atualizarValorReal();
  }
  
  const kGains = document.getElementById("kGains");
  const kStops = document.getElementById("kStops");
  const kZero = document.getElementById("kZero");
  
  if (kGains) kGains.textContent = totais.gain;
  if (kStops) kStops.textContent = totais.stop;
  if (kZero) kZero.textContent = totais.zero;
 },
 
 atualizarSidebarStats(dados) {
  const totais = dados.reduce((acc, d) => ({
   pontos: acc.pontos + d.pontos,
   gain: acc.gain + d.gain,
   stop: acc.stop + d.stop
  }), { pontos: 0, gain: 0, stop: 0 });
  
  const diasOperados = dados.filter(d => d.trades > 0).length;
  const operacoes = totais.gain + totais.stop;
  const winRate = operacoes ? Math.round((totais.gain / operacoes) * 100) : 0;
  
  const pontosPorDia = dados.filter(d => d.trades > 0).map(d => d.pontos);
  const melhorDia = pontosPorDia.length ? Math.max(...pontosPorDia) : 0;
  const piorDia = pontosPorDia.length ? Math.min(...pontosPorDia) : 0;
  
  const sidebarWinRate = document.getElementById('sidebarWinRate');
  const sidebarBestDay = document.getElementById('sidebarBestDay');
  const sidebarWorstDay = document.getElementById('sidebarWorstDay');
  
  if (sidebarWinRate) sidebarWinRate.textContent = winRate + '%';
  if (sidebarBestDay) {
   sidebarBestDay.textContent = melhorDia;
   sidebarBestDay.style.color = 'var(--green)';
  }
  if (sidebarWorstDay) {
   sidebarWorstDay.textContent = piorDia;
   sidebarWorstDay.style.color = piorDia < 0 ? 'var(--red)' : 'var(--text)';
  }
 },
 
 atualizarPerformanceIndicator(dados = []) {
  const perfIndicator = document.getElementById('perfIndicator');
  const perfText = document.getElementById('perfText');
  const perfDot = perfIndicator?.querySelector('.performance-dot');
  
  if (!perfIndicator || !dados.length) {
   if (perfIndicator) perfIndicator.style.display = 'none';
   return;
  }
  
  const totais = dados.reduce((acc, d) => acc + d.pontos, 0);
  
  perfIndicator.style.display = 'flex';
  
  if (totais > 0) {
   perfText.textContent = `Performance: Positiva (+${totais})`;
   perfDot.className = 'performance-dot positive';
  } else if (totais < 0) {
   perfText.textContent = `Performance: Negativa (${totais})`;
   perfDot.className = 'performance-dot negative';
  } else {
   perfText.textContent = 'Performance: Neutro';
   perfDot.className = 'performance-dot neutral';
  }
 },
 
 renderizarTabela(dados) {
  let html = '';
  let tot = {p:0, t:0, g:0, s:0, z:0};
  
  dados.forEach(d => {
   tot.p += d.pontos; tot.t += d.trades;
   tot.g += d.gain; tot.s += d.stop; tot.z += d.zero;
   
   html += `
    <tr>
     <td>${d.dia}</td>
     <td style="color:${d.pontos<0?'var(--red)':'var(--green)'};font-weight:800">${d.pontos}</td>
     <td>${d.trades}</td>
     <td style="color:var(--green)">${d.gain}</td>
     <td style="color:var(--red)">${d.stop}</td>
     <td style="color:var(--yellow)">${d.zero}</td>
     <td>${d.ativo}</td>
     <td>${d.semana}</td>
    </tr>`;
  });
  
  html += `
   <tr class="total">
    <td>TOTAL</td>
    <td style="color:${tot.p<0?'var(--red)':'var(--green)'}">${tot.p}</td>
    <td>${tot.t}</td>
    <td style="color:var(--green)">${tot.g}</td>
    <td style="color:var(--red)">${tot.s}</td>
    <td style="color:var(--yellow)">${tot.z}</td>
    <td colspan="2"></td>
   </tr>`;
  
  document.getElementById('tbody').innerHTML = html;
 },
 
 renderizarGraficos(dados) {
  let saldo = 0;
  const labels = [];
  const acumulado = [0];
  
  dados.forEach(d => {
   saldo += d.pontos;
   labels.push(d.dia);
   acumulado.push(saldo);
  });
  
  if (this.chartAcumulado) this.chartAcumulado.destroy();
  if (this.chartBar) this.chartBar.destroy();
  
  const ctxAc = document.getElementById('chartAcumulado');
  const ctxBar = document.getElementById('chartBar');
  
  if (ctxAc) {
   this.chartAcumulado = new Chart(ctxAc, {
    type: 'line',
    data: {
     labels: ['In√≠cio', ...labels],
     datasets: [{
      label: 'Pontos Acumulados',
      data: acumulado,
      borderColor: '#6366f1',
      backgroundColor: (context) => {
       const ctx = context.chart.ctx;
       const gradient = ctx.createLinearGradient(0, 0, 0, 400);
       gradient.addColorStop(0, 'rgba(99,102,241,0.3)');
       gradient.addColorStop(1, 'rgba(99,102,241,0.01)');
       return gradient;
      },
      fill: true,
      tension: 0.4,
      borderWidth: 3,
      pointRadius: 4,
      pointHoverRadius: 6,
      pointBackgroundColor: '#6366f1',
      pointBorderColor: '#fff',
      pointBorderWidth: 2
     }]
    },
    options: {
     responsive: true,
     maintainAspectRatio: false,
     interaction: {
      intersect: false,
      mode: 'index'
     },
     plugins: {
      legend: { display: false },
      tooltip: {
       backgroundColor: 'rgba(0,0,0,0.9)',
       titleColor: '#fff',
       bodyColor: '#e5e7eb',
       borderColor: '#6366f1',
       borderWidth: 1,
       padding: 12,
       displayColors: false,
       callbacks: {
        title: (items) => items[0].label,
        label: (item) => `Acumulado: ${item.formattedValue} pts`
       }
      }
     },
     scales: {
      y: {
       ticks: { color: '#9ca3af', font: { family: 'JetBrains Mono', size: 11 } },
       grid: { color: 'rgba(255,255,255,0.05)' }
      },
      x: {
       ticks: { 
        color: '#cbd5e1', 
        maxRotation: 45, 
        font: { size: 11, weight: '600' }
       },
       grid: { display: false }
      }
     }
    }
   });
  }
  
  if (ctxBar) {
   const totalGain = dados.reduce((a,b) => a+b.gain, 0);
   const totalStop = dados.reduce((a,b) => a+b.stop, 0);
   const totalZero = dados.reduce((a,b) => a+b.zero, 0);
   
   this.chartBar = new Chart(ctxBar, {
    type: 'doughnut',
    data: {
     labels: ['Gains', 'Stops', 'Breakeven'],
     datasets: [{
      data: [totalGain, totalStop, totalZero],
      backgroundColor: ['#10b981', '#ef4444', '#fbbf24'],
      borderColor: '#0f1420',
      borderWidth: 3,
      hoverOffset: 10
     }]
    },
    options: {
     responsive: true,
     maintainAspectRatio: false,
     plugins: {
      legend: {
       display: true,
       position: 'bottom',
       labels: {
        color: '#9ca3af',
        padding: 16,
        font: { size: 12, weight: '600' }
       }
      },
      tooltip: {
       backgroundColor: 'rgba(0,0,0,0.9)',
       titleColor: '#fff',
       bodyColor: '#e5e7eb',
       borderColor: '#6366f1',
       borderWidth: 1,
       padding: 12,
       callbacks: {
        label: (item) => `${item.label}: ${item.formattedValue} opera√ß√µes`
       }
      }
     }
    }
   });
  }
 },
 
 voltarParaMeses() {
  filtroMes.value = "ALL";
  filtroSemana.disabled = true;
  filtroSemana.value = "ALL";
  this.primeiraCarga = false;
  this.atualizar();
 },
 
 abrirModal(dadosDia) {
  console.log('üì∏ Abrindo modal com dados:', dadosDia);
  
  const modal = document.getElementById('tradePhotoModal');
  const modalTitle = document.getElementById('modalTitle');
  const modalInfoGrid = document.getElementById('modalInfoGrid');
  const modalPhotoContainer = document.getElementById('modalPhotoContainer');
  
  if (!modal || !modalTitle || !modalInfoGrid || !modalPhotoContainer) {
   console.error('‚ùå Elementos do modal n√£o encontrados');
   return;
  }
  
  // Formata a data
  const data = new Date(dadosDia.data);
  const dia = data.getDate();
  const mes = nomesMeses[dadosDia.mes];
  const ano = dadosDia.ano;
  
  console.log('üìÖ Data formatada:', `${dia} de ${mes} de ${ano}`);
  
  // Atualiza t√≠tulo
  modalTitle.textContent = `üìÖ ${dia} de ${mes} de ${ano}`;
  
  // Monta grid de informa√ß√µes
  let infoHTML = `
   <div class="modal-info-item ${dadosDia.pontos > 0 ? 'positive' : dadosDia.pontos < 0 ? 'negative' : ''}">
    <label>Pontos</label>
    <div class="value">${dadosDia.pontos > 0 ? '+' : ''}${dadosDia.pontos}</div>
   </div>
   <div class="modal-info-item">
    <label>Trades</label>
    <div class="value">${dadosDia.trades}</div>
   </div>
   <div class="modal-info-item positive">
    <label>Gains</label>
    <div class="value">${dadosDia.gain}</div>
   </div>
   <div class="modal-info-item negative">
    <label>Stops</label>
    <div class="value">${dadosDia.stop}</div>
   </div>
  `;
  
  if (dadosDia.zero > 0) {
   infoHTML += `
    <div class="modal-info-item">
     <label>Breakeven</label>
     <div class="value" style="color: var(--yellow)">${dadosDia.zero}</div>
    </div>
   `;
  }
  
  modalInfoGrid.innerHTML = infoHTML;
  
  console.log('üñºÔ∏è Carregando foto. ID:', dadosDia.fotoId);
  
  // Carrega a foto (passa o ID da foto se existir)
  this.carregarFotoTrade(dadosDia.dia, modalPhotoContainer, dadosDia.fotoId);
  
  // Mostra modal
  modal.classList.add('active');
  document.body.style.overflow = 'hidden';
  
  console.log('‚úÖ Modal aberto com sucesso');
 },
 
 fecharModal() {
  const modal = document.getElementById('tradePhotoModal');
  modal.classList.remove('active');
  document.body.style.overflow = 'auto';
  
  // Reset zoom
  this.zoomLevel = 1;
  this.zoomPosX = 0;
  this.zoomPosY = 0;
 },
 
 async inicializarConversorMoeda() {
  // Busca cota√ß√£o atual
  await this.atualizarCotacao();
 },
 
 async atualizarCotacao() {
  try {
   const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
   const data = await response.json();
   this.cotacaoUSDtoBRL = data.rates.BRL;
   console.log('üí± Cota√ß√£o USD ‚Üí BRL:', this.cotacaoUSDtoBRL.toFixed(2));
  } catch (error) {
   console.warn('‚ö†Ô∏è Erro ao buscar cota√ß√£o, usando valor padr√£o:', this.cotacaoUSDtoBRL);
  }
 },
 
 atualizarValorReal() {
  const valorBRL = document.getElementById('valorBRL');
  if (valorBRL) {
   const valorEmReais = this.valorTotalUSD * this.cotacaoUSDtoBRL;
   valorBRL.textContent = valorEmReais.toLocaleString('pt-BR', { 
    style: 'currency', 
    currency: 'BRL' 
   });
  }
 },
 
 inicializarZoomFoto(container, img) {
  // Adiciona controles de zoom
  const controls = document.createElement('div');
  controls.className = 'zoom-controls';
  controls.innerHTML = `
   <button class="zoom-btn" id="zoomIn" title="Zoom In (+)">+</button>
   <button class="zoom-btn" id="zoomOut" title="Zoom Out (-)">‚àí</button>
   <button class="zoom-btn" id="zoomReset" title="Reset (0)">‚ü≤</button>
  `;
  container.appendChild(controls);
  
  // Info de zoom
  const zoomInfo = document.createElement('div');
  zoomInfo.className = 'zoom-info';
  zoomInfo.textContent = '100%';
  container.appendChild(zoomInfo);
  
  // Bot√µes de zoom
  document.getElementById('zoomIn').addEventListener('click', () => this.zoom(img, container, 0.2));
  document.getElementById('zoomOut').addEventListener('click', () => this.zoom(img, container, -0.2));
  document.getElementById('zoomReset').addEventListener('click', () => this.resetZoom(img, container));
  
  // Zoom com scroll do mouse
  container.addEventListener('wheel', (e) => {
   e.preventDefault();
   const delta = e.deltaY > 0 ? -0.1 : 0.1;
   this.zoom(img, container, delta);
  }, { passive: false });
  
  // Pan (arrastar) - Mouse
  container.addEventListener('mousedown', (e) => {
   if (this.zoomLevel > 1) {
    this.isDragging = true;
    this.startX = e.clientX - this.zoomPosX;
    this.startY = e.clientY - this.zoomPosY;
    container.classList.add('grabbing');
    e.preventDefault();
   }
  });
  
  container.addEventListener('mousemove', (e) => {
   if (this.isDragging) {
    this.zoomPosX = e.clientX - this.startX;
    this.zoomPosY = e.clientY - this.startY;
    this.atualizarTransform(img);
   }
  });
  
  container.addEventListener('mouseup', () => {
   this.isDragging = false;
   container.classList.remove('grabbing');
  });
  
  container.addEventListener('mouseleave', () => {
   this.isDragging = false;
   container.classList.remove('grabbing');
  });
  
  // Touch (mobile)
  let lastTouchDistance = 0;
  let lastTouchX = 0;
  let lastTouchY = 0;
  
  container.addEventListener('touchstart', (e) => {
   if (e.touches.length === 2) {
    // Pinch zoom
    const touch1 = e.touches[0];
    const touch2 = e.touches[1];
    lastTouchDistance = Math.hypot(
     touch2.clientX - touch1.clientX,
     touch2.clientY - touch1.clientY
    );
   } else if (e.touches.length === 1 && this.zoomLevel > 1) {
    // Pan
    this.isDragging = true;
    lastTouchX = e.touches[0].clientX;
    lastTouchY = e.touches[0].clientY;
    this.startX = lastTouchX - this.zoomPosX;
    this.startY = lastTouchY - this.zoomPosY;
    container.classList.add('grabbing');
   }
  });
  
  container.addEventListener('touchmove', (e) => {
   if (e.touches.length === 2) {
    // Pinch zoom
    e.preventDefault();
    const touch1 = e.touches[0];
    const touch2 = e.touches[1];
    const distance = Math.hypot(
     touch2.clientX - touch1.clientX,
     touch2.clientY - touch1.clientY
    );
    const delta = (distance - lastTouchDistance) / 100;
    this.zoom(img, container, delta);
    lastTouchDistance = distance;
   } else if (e.touches.length === 1 && this.isDragging) {
    // Pan
    e.preventDefault();
    this.zoomPosX = e.touches[0].clientX - this.startX;
    this.zoomPosY = e.touches[0].clientY - this.startY;
    this.atualizarTransform(img);
   }
  }, { passive: false });
  
  container.addEventListener('touchend', () => {
   this.isDragging = false;
   container.classList.remove('grabbing');
   lastTouchDistance = 0;
  });
 },
 
 zoom(img, container, delta) {
  this.zoomLevel = Math.max(1, Math.min(5, this.zoomLevel + delta));
  
  if (this.zoomLevel === 1) {
   this.zoomPosX = 0;
   this.zoomPosY = 0;
  }
  
  this.atualizarTransform(img);
  this.mostrarZoomInfo(container);
 },
 
 resetZoom(img, container) {
  this.zoomLevel = 1;
  this.zoomPosX = 0;
  this.zoomPosY = 0;
  this.atualizarTransform(img);
  this.mostrarZoomInfo(container);
 },
 
 atualizarTransform(img) {
  img.style.transform = `scale(${this.zoomLevel}) translate(${this.zoomPosX / this.zoomLevel}px, ${this.zoomPosY / this.zoomLevel}px)`;
 },
 
 mostrarZoomInfo(container) {
  const zoomInfo = container.querySelector('.zoom-info');
  if (zoomInfo) {
   zoomInfo.textContent = `${Math.round(this.zoomLevel * 100)}%`;
   zoomInfo.classList.add('show');
   setTimeout(() => zoomInfo.classList.remove('show'), 1500);
  }
 },
 
 carregarFotoTrade(dataStr, container, fotoId) {
  const [dia, mes, ano] = dataStr.split('/');
  const nomeArquivo = `${dia}-${mes}-${ano}`;
  
  console.log('====== DEBUG FOTO ======');
  console.log('üìÖ Data:', dataStr);
  console.log('üìù Nome arquivo:', nomeArquivo);
  console.log('üÜî ID recebido:', fotoId);
  console.log('üîç ID tipo:', typeof fotoId);
  console.log('üìè ID length:', fotoId ? fotoId.length : 0);
  console.log('‚úÇÔ∏è ID trimmed:', fotoId ? fotoId.trim() : 'VAZIO');
  
  container.innerHTML = `
   <div class="modal-photo-loading">
    <div class="modal-photo-spinner"></div>
    Carregando foto...
   </div>
  `;
  
  // Se tiver ID da foto (da planilha), usa direto
  if (fotoId && fotoId.trim()) {
   const idLimpo = fotoId.trim();
   
   // Testa 3 URLs diferentes do Google Drive
   const urls = [
    `https://drive.google.com/uc?export=view&id=${idLimpo}`,
    `https://drive.google.com/thumbnail?id=${idLimpo}&sz=w1000`,
    `https://lh3.googleusercontent.com/d/${idLimpo}`
   ];
   
   console.log('üì∏ Tentando URLs:');
   urls.forEach((u, i) => console.log(`   ${i+1}. ${u}`));
   
   let tentativaAtual = 0;
   
   const tentarProximaURL = () => {
    if (tentativaAtual >= urls.length) {
     console.error('‚ùå TODAS AS URLs falharam!');
     console.error('üî¥ ID usado:', idLimpo);
     console.error('');
     console.error('üîß CHECKLIST:');
     console.error('1. Foto est√° compartilhada como "Qualquer pessoa com o link"?');
     console.error('2. ID est√° correto?');
     console.error('3. Arquivo existe no Drive?');
     
     container.innerHTML = `
      <div class="modal-photo-error">
       ‚ùå N√£o foi poss√≠vel carregar a foto<br>
       <small style="font-size: 11px; opacity: 0.7; margin-top: 10px; display: block; line-height: 1.5;">
        <strong>ID testado:</strong><br>
        <code style="background: rgba(255,0,0,0.2); padding: 2px 6px; border-radius: 4px; font-size: 10px; word-break: break-all;">${idLimpo}</code><br><br>
        <strong>Verifique:</strong><br>
        1Ô∏è‚É£ Foto est√° como "Qualquer pessoa com o link"<br>
        2Ô∏è‚É£ ID est√° correto na planilha<br>
        3Ô∏è‚É£ Arquivo n√£o foi deletado<br><br>
        <strong>Teste voc√™ mesmo:</strong><br>
        Cole este link no navegador:<br>
        <code style="font-size: 9px; word-break: break-all;">drive.google.com/file/d/${idLimpo}/view</code>
       </small>
      </div>
     `;
     return;
    }
    
    const urlAtual = urls[tentativaAtual];
    console.log(`üîÑ Tentativa ${tentativaAtual + 1}/${urls.length}: ${urlAtual}`);
    
    const img = new Image();
    img.crossOrigin = 'anonymous';
    
    img.onload = () => {
     console.log(`‚úÖ SUCESSO na tentativa ${tentativaAtual + 1}!`);
     console.log('üñºÔ∏è URL que funcionou:', urlAtual);
     console.log('üìê Dimens√µes:', img.width, 'x', img.height);
     
     container.innerHTML = `<img src="${urlAtual}" alt="Trade do dia ${dataStr}" crossorigin="anonymous" id="zoomableImage">`;
     
     // Inicializa zoom ap√≥s imagem estar no DOM
     setTimeout(() => {
      const imgElement = document.getElementById('zoomableImage');
      if (imgElement) {
       Dashboard.resetZoom(imgElement, container);
       Dashboard.inicializarZoomFoto(container, imgElement);
      }
     }, 100);
    };
    
    img.onerror = () => {
     console.warn(`‚ö†Ô∏è Falha na tentativa ${tentativaAtual + 1}`);
     tentativaAtual++;
     tentarProximaURL();
    };
    
    img.src = urlAtual;
   };
   
   tentarProximaURL();
   
  } else {
   console.warn('‚ö†Ô∏è NENHUM ID FORNECIDO');
   console.warn('Verifique se a coluna FOTO_ID tem valor na planilha');
   
   container.innerHTML = `
    <div class="modal-photo-error">
     üì∑ Nenhuma foto configurada<br>
     <small style="font-size: 11px; opacity: 0.8; margin-top: 10px; display: block;">
      O ID da foto n√£o est√° na planilha.<br><br>
      <strong>Como adicionar:</strong><br>
      1. Coluna <strong>FOTO_ID</strong> (coluna I)<br>
      2. Cole o ID da foto do Google Drive<br>
      3. Menu: <strong>üì∏ Fotos ‚Üí Sincronizar</strong>
     </small>
    </div>
   `;
  }
  
  console.log('========================');
 },
 
 renderizarCalendario(dados) {
  const grid = document.getElementById("calendar");
  const calendarTitle = document.getElementById("calendarTitle");
  
  if (!grid) return;
  
  grid.innerHTML = "";
  
  // Se estiver em "Todos os meses", mostra seletor de meses
  if (filtroMes.value === "ALL") {
   if (calendarTitle) {
    calendarTitle.textContent = `üìÖ Selecione um M√™s`;
   }
   
   // Pega todos os meses dispon√≠veis para o ano selecionado
   const mesesDisponiveis = [...new Set(
    this.dados
     .filter(d => d.ano === filtroAno.value)
     .map(d => d.mes)
   )].sort();
   
   // Cria cards clic√°veis para cada m√™s
   mesesDisponiveis.forEach(mesNum => {
    const nomeMes = nomesMeses[mesNum];
    const dadosDoMes = this.dados.filter(d => d.ano === filtroAno.value && d.mes === mesNum);
    const totalPontos = dadosDoMes.reduce((acc, d) => acc + d.pontos, 0);
    const diasOperados = dadosDoMes.filter(d => d.trades > 0).length;
    
    const mesCard = document.createElement('div');
    mesCard.className = 'month-card';
    if (totalPontos > 0) mesCard.classList.add('positive');
    if (totalPontos < 0) mesCard.classList.add('negative');
    
    mesCard.innerHTML = `
     <div class="month-name">${nomeMes}</div>
     <div class="month-points" style="color:${totalPontos<0?'var(--red)':totalPontos>0?'var(--green)':'var(--muted)'}">
      ${totalPontos > 0 ? '+' : ''}${totalPontos}
     </div>
     <div class="month-info">${diasOperados} dia${diasOperados !== 1 ? 's' : ''}</div>
    `;
    
    mesCard.onclick = () => {
     filtroMes.value = mesNum;
     this.primeiraCarga = false;
     filtroSemana.disabled = false;
     this.inicializarSemanas();
     this.atualizar();
    };
    
    grid.appendChild(mesCard);
   });
   
   return;
  }
  
  // Se um m√™s espec√≠fico est√° selecionado, mostra o calend√°rio normal
  if (!dados.length) return;
  
  let base = dados.find(d => d.mes === filtroMes.value) || dados[0];
  
  const ano = base.data.getFullYear();
  const mes = base.data.getMonth();
  const primeiro = new Date(ano, mes, 1);
  const ultimo = new Date(ano, mes+1, 0);
  
  // Atualiza o t√≠tulo com o nome do m√™s e bot√£o de voltar
  const mesStr = (mes + 1).toString().padStart(2, "0");
  const nomeMes = nomesMeses[mesStr] || "";
  if (calendarTitle) {
   calendarTitle.innerHTML = `
    <button class="back-to-months-btn" onclick="Dashboard.voltarParaMeses()" title="Voltar para sele√ß√£o de meses">
     ‚Üê Voltar
    </button>
    <span>üìÖ ${nomeMes} ${ano}</span>
    <div></div>
   `;
  }
  
  for (let i = 0; i < primeiro.getDay(); i++) {
   const emptyDay = document.createElement('div');
   emptyDay.className = 'day empty';
   grid.appendChild(emptyDay);
  }
  
  for (let d = 1; d <= ultimo.getDate(); d++) {
   const data = new Date(ano, mes, d);
   const r = dados.find(x => x.data.toDateString() === data.toDateString());
   
   const dayDiv = document.createElement('div');
   dayDiv.className = 'day';
   
   let pts = "";
   let info = "";
   let badge = "";
   
   if (r) {
    pts = r.pontos;
    if (pts > 0) dayDiv.classList.add('positive');
    if (pts < 0) dayDiv.classList.add('negative');
    
    let primeiraLinha = `${r.trades} trade${r.trades !== 1 ? 's' : ''}`;
    
    let segundaLinha = [];
    if (r.gain > 0) segundaLinha.push(`${r.gain} gain${r.gain !== 1 ? 's' : ''}`);
    if (r.stop > 0) segundaLinha.push(`${r.stop} stop${r.stop !== 1 ? 's' : ''}`);
    if (r.zero > 0) segundaLinha.push(`${r.zero} 0x0`);
    
    if (segundaLinha.length > 0) {
     info = `${primeiraLinha}<br>${segundaLinha.join(' ‚Ä¢ ')}`;
    } else {
     info = primeiraLinha;
    }
    
    badge = `<div class="day-badge">${r.semana} ‚Ä¢ ${r.ativo}</div>`;
    
    // Adiciona evento de clique apenas se houver trades E foto
    if (r.trades > 0 && r.fotoId && r.fotoId.toString().trim() !== '') {
     dayDiv.classList.add('clickable');
     dayDiv.style.cursor = 'pointer';
     
     // Adiciona evento de clique
     dayDiv.addEventListener('click', () => {
      Dashboard.abrirModal(r);
     });
    }
   }
   
   // Monta o HTML interno
   const ptsDisplay = r && r.trades > 0 ? (pts === 0 ? '0' : pts) : (pts || "");
   const ptsColor = pts < 0 ? 'var(--red)' : pts > 0 ? 'var(--green)' : 'var(--muted)';
   
   dayDiv.innerHTML = `
    <div class="day-number">${d}</div>
    <div class="day-points" style="color:${ptsColor}">
     ${ptsDisplay}
    </div>
    <div class="day-info">${info}</div>
    ${badge}
   `;
   
   grid.appendChild(dayDiv);
  }
 }
};

Dashboard.init();

// Fechar modal ao clicar fora
document.getElementById('tradePhotoModal')?.addEventListener('click', (e) => {
 if (e.target.id === 'tradePhotoModal') {
  Dashboard.fecharModal();
 }
});

// Fechar modal com ESC e alternar modo com Ctrl+M
document.addEventListener('keydown', (e) => {
 if (e.key === 'Escape') {
  Dashboard.fecharModal();
 }
 if (e.ctrlKey && e.key === 'm') {
  e.preventDefault();
  document.getElementById('toggleMode')?.click();
 }
});
</script>
</body>
</html>
