<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard NASDAQ PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
 --bg:#020617;
 --card:#050b1a;
 --border:rgba(255,255,255,.08);
 --text:#e5e7eb;
 --muted:#9ca3af;
 --green:#22c55e;
 --red:#ef4444;
 --yellow:#facc15;
 --blue:#93c5fd;
}

*{
 box-sizing:border-box;
 font-family:Inter,system-ui,-apple-system,BlinkMacSystemFont;
}

body{
 margin:0;
 background:
  radial-gradient(circle at top,
   #334155 0%,
   #1e293b 35%,
   #020617 75%);
 color:var(--text);
}

.container{
 max-width:1600px;
 margin:auto;
 padding:clamp(16px,2vw,28px);
}

/* HEADER */
.header{
 display:flex;
 flex-direction:column;
 align-items:flex-start;
 margin-bottom:36px;
}

.header img{ height:84px; }

.dashboard-title{
 margin-top:20px;
 font-size:22px;
 letter-spacing:4px;
 font-weight:900;
 color:var(--blue);
}

/* LOADING */
.loading-overlay{
 position:fixed;
 top:0;
 left:0;
 right:0;
 bottom:0;
 background:rgba(2,6,23,0.95);
 display:flex;
 align-items:center;
 justify-content:center;
 z-index:9999;
 opacity:1;
 transition:opacity 0.3s ease;
}

.loading-overlay.hidden{
 opacity:0;
 pointer-events:none;
}

.loading-content{
 text-align:center;
}

.spinner{
 width:60px;
 height:60px;
 border:4px solid var(--border);
 border-top-color:var(--blue);
 border-radius:50%;
 animation:spin 0.8s linear infinite;
 margin:0 auto 20px;
}

@keyframes spin{
 to{transform:rotate(360deg);}
}

.error-message{
 background:linear-gradient(135deg,#991b1b,#7f1d1d);
 color:white;
 padding:24px;
 border-radius:16px;
 margin:20px;
 border-left:4px solid var(--red);
 box-shadow:0 8px 24px rgba(0,0,0,0.3);
}

.error-message h3{
 margin:0 0 12px 0;
 font-size:20px;
}

.error-message p{
 margin:0;
 opacity:0.9;
}

/* FILTROS */
.filters{
 display:flex;
 gap:12px;
 margin-bottom:24px;
 flex-wrap:wrap;
}

select{
 background:var(--card);
 color:var(--text);
 border:1px solid var(--border);
 border-radius:14px;
 padding:12px 16px;
 font-size:15px;
 width:220px;
 cursor:pointer;
 transition:all 0.2s ease;
}

select:hover{
 border-color:var(--blue);
}

select:focus{
 outline:none;
 border-color:var(--blue);
 box-shadow:0 0 0 3px rgba(147,197,253,0.1);
}

/* KPIs */
.kpis{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
 gap:16px;
 margin-bottom:28px;
}

.kpi{
 background:linear-gradient(180deg,#050b1a,#030818);
 border:1px solid var(--border);
 border-radius:18px;
 padding:18px;
 transition:transform 0.2s ease,box-shadow 0.2s ease;
}

.kpi:hover{
 transform:translateY(-2px);
 box-shadow:0 8px 20px rgba(0,0,0,0.3);
}

.kpi span{
 color:var(--muted);
 font-size:13px;
 text-transform:uppercase;
 letter-spacing:0.5px;
}

.kpi strong{
 display:block;
 margin-top:8px;
 font-size:28px;
}

/* GR√ÅFICOS */
.cards{
 display:grid;
 grid-template-columns:1.3fr 1fr;
 gap:16px;
 margin-bottom:24px;
}

.card{
 background:linear-gradient(180deg,#050b1a,#030818);
 border:1px solid var(--border);
 border-radius:22px;
 padding:18px;
 height:420px;
 display:flex;
 flex-direction:column;
}

.card strong{
 margin-bottom:12px;
 font-size:18px;
 color:var(--blue);
}

.chart-wrap{
 flex:1;
 position:relative;
 min-height:0;
}

canvas{
 width:100%!important;
 height:100%!important;
}

/* TABELA */
.table-wrap{ 
 overflow-x:auto;
 margin-top:16px;
}

table{
 width:100%;
 min-width:900px;
 border-collapse:collapse;
}

thead{
 background:linear-gradient(180deg,#020b2a,#020617);
 position:sticky;
 top:0;
 z-index:10;
}

th{
 color:var(--blue);
 font-weight:700;
 font-size:16px;
 padding:14px 10px;
 text-align:center;
 white-space:nowrap;
}

td{
 padding:12px 10px;
 border-bottom:1px solid var(--border);
 text-align:center;
}

thead th:first-child,
tbody td:first-child{
 text-align:left;
 padding-left:16px;
}

tr.total{
 background:rgba(34,197,94,.08);
 font-weight:700;
}

tbody tr:hover{
 background:rgba(147,197,253,0.05);
}

/* CALEND√ÅRIO */
.calendar-wrapper{
 margin-bottom:28px;
 background:linear-gradient(180deg,#050b1a,#030818);
 border:1px solid var(--border);
 border-radius:22px;
 padding:18px;
}

.calendar-wrapper strong{
 display:block;
 margin-bottom:16px;
 font-size:18px;
 color:var(--blue);
}

.calendar-header{
 display:grid;
 grid-template-columns:repeat(7,1fr);
 margin-bottom:10px;
 text-align:center;
 color:var(--muted);
 font-size:14px;
 font-weight:600;
}

.calendar-grid{
 display:grid;
 grid-template-columns:repeat(7,1fr);
 gap:12px;
}

.day{
 position:relative;
 background:linear-gradient(180deg,#052e2b,#020617);
 border:1px solid var(--border);
 border-radius:16px;
 min-height:120px;
 padding:10px;
 padding-bottom:42px;
 display:flex;
 flex-direction:column;
 transition:transform 0.2s ease,box-shadow 0.2s ease;
}

.day:hover:not(.empty){
 transform:translateY(-2px);
 box-shadow:0 8px 20px rgba(0,0,0,0.3);
}

.day.positive{
 background:linear-gradient(180deg,#053a32,#020617);
}

.day.negative{
 background:linear-gradient(180deg,#3a0505,#020617);
}

.day-number{
 font-size:14px;
 color:var(--muted);
 font-weight:600;
}

.day-points{
 flex:1;
 display:flex;
 align-items:center;
 justify-content:center;
 font-size:26px;
 font-weight:800;
}

.day-info{
 font-size:11px;
 color:var(--muted);
 text-align:center;
 line-height:1.4;
}

.day-badge{
 position:absolute;
 bottom:8px;
 left:50%;
 transform:translateX(-50%);
 background:rgba(0,0,0,.75);
 border:1px solid var(--border);
 border-radius:10px;
 padding:5px 8px;
 font-size:10px;
 white-space:nowrap;
}

.empty{
 background:transparent;
 border:none;
}

/* RESPONSIVIDADE */
@media (max-width: 1024px) {
 .cards {
  grid-template-columns: 1fr;
 }
 
 .card {
  height: 350px;
 }
}

@media (max-width: 768px) {
 .kpis {
  grid-template-columns: repeat(2, 1fr);
 }
 
 .calendar-grid {
  gap: 6px;
 }
 
 .day {
  min-height: 80px;
  padding: 6px;
  padding-bottom: 32px;
 }
 
 .day-points {
  font-size: 18px;
 }
 
 .day-badge {
  font-size: 8px;
  padding: 3px 6px;
 }
 
 select {
  width: 100%;
 }
}

@media (max-width: 480px) {
 .kpis {
  grid-template-columns: 1fr;
 }
 
 .dashboard-title {
  font-size: 18px;
  letter-spacing: 2px;
 }
}
</style>
</head>

<body>
<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
 <div class="loading-content">
  <div class="spinner"></div>
  <p style="color:var(--text);font-size:16px;">Carregando dados...</p>
 </div>
</div>

<div class="container" id="mainContainer">

<div class="header">
 <img src="logo.png" alt="Mentoria NasdaqPro">
 <span class="dashboard-title">DASHBOARD</span>
</div>

<div class="filters">
 <select id="filtroAno" aria-label="Selecionar ano"></select>
 <select id="filtroMes" aria-label="Selecionar m√™s"></select>
 <select id="filtroSemana" aria-label="Selecionar semana"></select>
</div>

<div class="kpis">
 <div class="kpi"><span>Trades</span><strong id="kTrades">0</strong></div>
 <div class="kpi"><span>Pontos</span><strong id="kPontos">0</strong></div>
 <div class="kpi"><span>Gains</span><strong id="kGains" style="color:var(--green)">0</strong></div>
 <div class="kpi"><span>Stops</span><strong id="kStops" style="color:var(--red)">0</strong></div>
 <div class="kpi"><span>0x0</span><strong id="kZero" style="color:var(--yellow)">0</strong></div>
 <div class="kpi"><span>Assertividade</span><strong id="kAcc">0%</strong></div>
</div>

<div class="cards">
 <div class="card">
  <strong>üìà Evolu√ß√£o Acumulada de Pontos</strong>
  <div class="chart-wrap"><canvas id="chartAcumulado"></canvas></div>
 </div>
 <div class="card">
  <strong>üìä Gains x Stops x 0x0</strong>
  <div class="chart-wrap"><canvas id="chartBar"></canvas></div>
 </div>
</div>

<!-- CALEND√ÅRIO -->
<div class="calendar-wrapper">
 <strong>üìÖ Calend√°rio Operacional</strong>
 <div class="calendar-header">
  <div>Dom</div><div>Seg</div><div>Ter</div>
  <div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div>
 </div>
 <div class="calendar-grid" id="calendar"></div>
</div>

<div class="card" style="height:auto">
 <strong>üìã Tabela Operacional</strong>
 <div class="table-wrap">
  <table>
   <thead>
    <tr>
     <th>Dia</th><th>Pontos</th><th>Trades</th>
     <th>Gain</th><th>Stop</th><th>0x0</th>
     <th>Ativo</th><th>Semana</th>
    </tr>
   </thead>
   <tbody id="tbody"></tbody>
  </table>
 </div>
</div>

</div>

<script>
// ============================================
// CONFIGURA√á√ïES E CONSTANTES
// ============================================
const CONFIG = {
 CSV_URL: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTbyybCny81vfVXQHmtlkKEOHHJ6xJ_pKSG_4ndkK0tH-YocrFeWY7qL41TS1IfvRQjLSbLIILV56OV/pub?output=csv",
 CACHE_KEY: 'nasdaq_dashboard_data',
 CACHE_TIME_KEY: 'nasdaq_dashboard_cache_time',
 CACHE_DURATION: 5 * 60 * 1000, // 5 minutos
 CHART_COLORS: {
  green: '#22c55e',
  red: '#ef4444',
  yellow: '#facc15',
  blue: '#93c5fd'
 }
};

const NOMES_MESES = {
 "01": "Janeiro", "02": "Fevereiro", "03": "Mar√ßo",
 "04": "Abril", "05": "Maio", "06": "Junho",
 "07": "Julho", "08": "Agosto", "09": "Setembro",
 "10": "Outubro", "11": "Novembro", "12": "Dezembro"
};

// ============================================
// ESTADO GLOBAL DO DASHBOARD
// ============================================
const Dashboard = {
 dados: [],
 charts: {
  acumulado: null,
  bar: null
 },
 elementos: {
  chartAcumulado: null,
  chartBar: null,
  filtroAno: null,
  filtroMes: null,
  filtroSemana: null,
  loadingOverlay: null
 },
 primeiraCarga: true,

 /**
  * Inicializa o dashboard
  */
 async init() {
  this.cacheElementos();
  await this.carregarDados();
 },

 /**
  * Cacheia refer√™ncias dos elementos DOM
  */
 cacheElementos() {
  this.elementos.chartAcumulado = document.getElementById("chartAcumulado");
  this.elementos.chartBar = document.getElementById("chartBar");
  this.elementos.filtroAno = document.getElementById("filtroAno");
  this.elementos.filtroMes = document.getElementById("filtroMes");
  this.elementos.filtroSemana = document.getElementById("filtroSemana");
  this.elementos.loadingOverlay = document.getElementById("loadingOverlay");
 },

 /**
  * Carrega dados do CSV com cache e error handling
  */
 async carregarDados() {
  try {
   // Tentar carregar do cache primeiro
   const dadosCache = this.tentarCarregarCache();
   if (dadosCache) {
    this.processarCSV(dadosCache);
    this.esconderLoading();
    return;
   }

   // Buscar do servidor
   const response = await fetch(CONFIG.CSV_URL);
   
   if (!response.ok) {
    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
   }

   const texto = await response.text();
   
   // Salvar no cache
   this.salvarCache(texto);
   
   // Processar dados
   this.processarCSV(texto);
   this.esconderLoading();

  } catch (erro) {
   console.error("Erro ao carregar dados:", erro);
   this.mostrarErro(erro);
  }
 },

 /**
  * Tenta carregar dados do localStorage
  */
 tentarCarregarCache() {
  try {
   const cached = localStorage.getItem(CONFIG.CACHE_KEY);
   const cacheTime = localStorage.getItem(CONFIG.CACHE_TIME_KEY);
   
   if (cached && cacheTime) {
    const idade = Date.now() - parseInt(cacheTime);
    if (idade < CONFIG.CACHE_DURATION) {
     console.log("Dados carregados do cache");
     return cached;
    }
   }
  } catch (e) {
   console.warn("Erro ao ler cache:", e);
  }
  return null;
 },

 /**
  * Salva dados no localStorage
  */
 salvarCache(dados) {
  try {
   localStorage.setItem(CONFIG.CACHE_KEY, dados);
   localStorage.setItem(CONFIG.CACHE_TIME_KEY, Date.now().toString());
  } catch (e) {
   console.warn("Erro ao salvar cache:", e);
  }
 },

 /**
  * Processa o texto CSV e popula this.dados
  */
 processarCSV(texto) {
  const linhas = texto.trim().split(/\r?\n/);
  linhas.shift(); // Remove cabe√ßalho

  this.dados = linhas
   .map(linha => {
    const colunas = linha.split(",");
    const [dia, mes, ano] = colunas[0].split("/");

    // Valida√ß√£o de data
    if (!dia || !mes || !ano) {
     console.warn("Data inv√°lida ignorada:", colunas[0]);
     return null;
    }

    return {
     dia: colunas[0],
     data: new Date(ano, mes - 1, dia),
     semana: colunas[1],
     ativo: colunas[2],
     ano: ano,
     mes: mes,
     pontos: parseFloat(colunas[3]) || 0,
     trades: parseInt(colunas[4]) || 0,
     gain: parseInt(colunas[5]) || 0,
     stop: parseInt(colunas[6]) || 0,
     zero: parseInt(colunas[7]) || 0
    };
   })
   .filter(Boolean); // Remove entradas inv√°lidas

  this.inicializarFiltros();
 },

 /**
  * Inicializa os filtros de ano
  */
 inicializarFiltros() {
  const anos = [...new Set(this.dados.map(d => d.ano))].sort();
  
  this.elementos.filtroAno.innerHTML = anos
   .map(a => `<option value="${a}">${a}</option>`)
   .join("");

  const anoAtual = new Date().getFullYear().toString();
  this.elementos.filtroAno.value = anos.includes(anoAtual) ? anoAtual : anos[anos.length - 1];

  this.elementos.filtroAno.onchange = () => {
   this.primeiraCarga = false;
   this.inicializarMeses();
   this.atualizar();
  };

  this.inicializarMeses();
 },

 /**
  * Inicializa os filtros de m√™s
  */
 inicializarMeses() {
  const meses = [...new Set(
   this.dados
    .filter(d => d.ano === this.elementos.filtroAno.value)
    .map(d => d.mes)
  )].sort();

  this.elementos.filtroMes.innerHTML = 
   '<option value="ALL">Todos os meses</option>' +
   meses.map(m => `<option value="${m}">${NOMES_MESES[m]}</option>`).join("");

  const mesAtual = (new Date().getMonth() + 1).toString().padStart(2, "0");
  this.elementos.filtroMes.value = 
   this.primeiraCarga && meses.includes(mesAtual) ? mesAtual : "ALL";

  this.elementos.filtroMes.onchange = () => {
   this.primeiraCarga = false;
   this.inicializarSemanas();
   this.atualizar();
  };

  this.inicializarSemanas();
 },

 /**
  * Inicializa os filtros de semana
  */
 inicializarSemanas() {
  const semanas = [...new Set(
   this.dados
    .filter(d => 
     d.ano === this.elementos.filtroAno.value &&
     (this.elementos.filtroMes.value === "ALL" || d.mes === this.elementos.filtroMes.value)
    )
    .map(d => d.semana)
  )].sort((a, b) => a - b);

  this.elementos.filtroSemana.innerHTML = 
   '<option value="ALL">Todas as semanas</option>' +
   semanas.map(s => `<option value="${s}">${s}</option>`).join("");

  if (this.primeiraCarga) {
   const hoje = new Date();
   const registroAtual = this.dados.find(d => 
    d.data.toDateString() === hoje.toDateString()
   );
   this.elementos.filtroSemana.value = registroAtual?.semana || "ALL";
  } else {
   this.elementos.filtroSemana.value = "ALL";
  }

  this.elementos.filtroSemana.onchange = () => {
   this.primeiraCarga = false;
   this.atualizar();
  };

  this.atualizar();
 },

 /**
  * Filtra os dados baseado nos filtros selecionados
  */
 obterDadosFiltrados() {
  return this.dados.filter(d =>
   d.ano === this.elementos.filtroAno.value &&
   (this.elementos.filtroMes.value === "ALL" || d.mes === this.elementos.filtroMes.value) &&
   (this.elementos.filtroSemana.value === "ALL" || d.semana === this.elementos.filtroSemana.value)
  );
 },

 /**
  * Atualiza todas as visualiza√ß√µes
  */
 atualizar() {
  const dadosFiltrados = this.obterDadosFiltrados();
  this.renderizarKPIs(dadosFiltrados);
  this.renderizarTabela(dadosFiltrados);
  this.renderizarGraficos(dadosFiltrados);
  this.renderizarCalendario(dadosFiltrados);
 },

 /**
  * Renderiza os KPIs
  */
 renderizarKPIs(dados) {
  const totais = dados.reduce((acc, d) => ({
   trades: acc.trades + d.trades,
   pontos: acc.pontos + d.pontos,
   gain: acc.gain + d.gain,
   stop: acc.stop + d.stop,
   zero: acc.zero + d.zero
  }), { trades: 0, pontos: 0, gain: 0, stop: 0, zero: 0 });

  const operacoes = totais.gain + totais.stop;
  const assertividade = operacoes ? Math.round((totais.gain / operacoes) * 100) : 0;

  document.getElementById("kTrades").textContent = totais.trades;
  document.getElementById("kPontos").textContent = totais.pontos;
  document.getElementById("kGains").textContent = totais.gain;
  document.getElementById("kStops").textContent = totais.stop;
  document.getElementById("kZero").textContent = totais.zero;
  document.getElementById("kAcc").textContent = assertividade + "%";
 },

 /**
  * Renderiza a tabela
  */
 renderizarTabela(dados) {
  const tbody = document.getElementById("tbody");
  
  // Usar DocumentFragment para melhor performance
  const fragment = document.createDocumentFragment();
  
  const totais = { p: 0, t: 0, g: 0, s: 0, z: 0 };

  dados.forEach(d => {
   totais.p += d.pontos;
   totais.t += d.trades;
   totais.g += d.gain;
   totais.s += d.stop;
   totais.z += d.zero;

   const tr = document.createElement('tr');
   tr.innerHTML = `
    <td>${d.dia}</td>
    <td style="color:${d.pontos < 0 ? 'var(--red)' : 'var(--green)'};font-weight:600">${d.pontos}</td>
    <td>${d.trades}</td>
    <td>${d.gain}</td>
    <td>${d.stop}</td>
    <td>${d.zero}</td>
    <td>${d.ativo}</td>
    <td>${d.semana}</td>
   `;
   fragment.appendChild(tr);
  });

  // Linha de totais
  const trTotal = document.createElement('tr');
  trTotal.className = 'total';
  trTotal.innerHTML = `
   <td>TOTAL</td>
   <td>${totais.p}</td>
   <td>${totais.t}</td>
   <td>${totais.g}</td>
   <td>${totais.s}</td>
   <td>${totais.z}</td>
   <td colspan="2"></td>
  `;
  fragment.appendChild(trTotal);

  tbody.innerHTML = '';
  tbody.appendChild(fragment);
 },

 /**
  * Renderiza os gr√°ficos com Chart.js
  */
 renderizarGraficos(dados) {
  let saldoAcumulado = 0;
  const labels = [];
  const pontosAcumulados = [0];

  dados.forEach(d => {
   saldoAcumulado += d.pontos;
   labels.push(d.dia);
   pontosAcumulados.push(saldoAcumulado);
  });

  // Calcular totais para gr√°fico de barras
  const totaisGraficos = dados.reduce((acc, d) => ({
   gain: acc.gain + d.gain,
   stop: acc.stop + d.stop,
   zero: acc.zero + d.zero
  }), { gain: 0, stop: 0, zero: 0 });

  // Atualizar ou criar gr√°fico de linha
  if (this.charts.acumulado) {
   this.charts.acumulado.data.labels = ["In√≠cio", ...labels];
   this.charts.acumulado.data.datasets[0].data = pontosAcumulados;
   this.charts.acumulado.update('none'); // 'none' = sem anima√ß√£o para melhor performance
  } else {
   this.charts.acumulado = new Chart(this.elementos.chartAcumulado, {
    type: "line",
    data: {
     labels: ["In√≠cio", ...labels],
     datasets: [{
      data: pontosAcumulados,
      borderColor: CONFIG.CHART_COLORS.green,
      backgroundColor: 'rgba(34, 197, 94, 0.1)',
      fill: true,
      tension: 0.35,
      pointRadius: 3,
      pointHoverRadius: 6
     }]
    },
    options: {
     responsive: true,
     maintainAspectRatio: false,
     plugins: {
      legend: { display: false },
      tooltip: {
       callbacks: {
        label: (context) => `Pontos: ${context.parsed.y}`
       }
      }
     },
     scales: {
      y: {
       grid: { color: 'rgba(255,255,255,0.05)' },
       ticks: { color: '#9ca3af' }
      },
      x: {
       grid: { display: false },
       ticks: { color: '#9ca3af', maxRotation: 45 }
      }
     }
    }
   });
  }

  // Atualizar ou criar gr√°fico de barras
  if (this.charts.bar) {
   this.charts.bar.data.datasets[0].data = [
    totaisGraficos.gain,
    totaisGraficos.stop,
    totaisGraficos.zero
   ];
   this.charts.bar.update('none');
  } else {
   this.charts.bar = new Chart(this.elementos.chartBar, {
    type: "bar",
    data: {
     labels: ["Gain", "Stop", "0x0"],
     datasets: [{
      data: [totaisGraficos.gain, totaisGraficos.stop, totaisGraficos.zero],
      backgroundColor: [
       CONFIG.CHART_COLORS.green,
       CONFIG.CHART_COLORS.red,
       CONFIG.CHART_COLORS.yellow
      ],
      borderRadius: 10,
      barThickness: 60
     }]
    },
    options: {
     responsive: true,
     maintainAspectRatio: false,
     plugins: {
      legend: { display: false },
      tooltip: {
       callbacks: {
        label: (context) => `${context.label}: ${context.parsed.y}`
       }
      }
     },
     scales: {
      y: {
       beginAtZero: true,
       grid: { color: 'rgba(255,255,255,0.05)' },
       ticks: { color: '#9ca3af' }
      },
      x: {
       grid: { display: false },
       ticks: { color: '#9ca3af' }
      }
     }
    }
   });
  }
 },

 /**
  * Renderiza o calend√°rio
  */
 renderizarCalendario(dados) {
  const grid = document.getElementById("calendar");
  grid.innerHTML = "";

  if (!dados.length) {
   grid.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:var(--muted);padding:40px">Nenhum dado dispon√≠vel</p>';
   return;
  }

  // Determinar qual m√™s exibir
  let dataBase = dados[0];
  if (this.elementos.filtroMes.value !== "ALL") {
   dataBase = dados.find(d => d.mes === this.elementos.filtroMes.value) || dados[0];
  }

  const ano = dataBase.data.getFullYear();
  const mes = dataBase.data.getMonth();
  const primeiroDia = new Date(ano, mes, 1);
  const ultimoDia = new Date(ano, mes + 1, 0);

  // Criar fragment para melhor performance
  const fragment = document.createDocumentFragment();

  // Dias vazios antes do primeiro dia do m√™s
  for (let i = 0; i < primeiroDia.getDay(); i++) {
   const div = document.createElement('div');
   div.className = 'day empty';
   fragment.appendChild(div);
  }

  // Dias do m√™s
  for (let dia = 1; dia <= ultimoDia.getDate(); dia++) {
   const dataAtual = new Date(ano, mes, dia);
   const registro = dados.find(d => 
    d.data.toDateString() === dataAtual.toDateString()
   );

   const div = document.createElement('div');
   div.className = 'day';

   if (registro) {
    const pontos = registro.pontos;
    
    if (pontos > 0) div.classList.add('positive');
    if (pontos < 0) div.classList.add('negative');

    div.innerHTML = `
     <div class="day-number">${dia}</div>
     <div class="day-points" style="color:${
      pontos < 0 ? 'var(--red)' : pontos > 0 ? 'var(--green)' : 'var(--muted)'
     }">
      ${pontos || ''}
     </div>
     <div class="day-info">
      Trades: ${registro.trades}<br>
      G:${registro.gain} S:${registro.stop}
     </div>
     <div class="day-badge">${registro.semana} | ${registro.ativo}</div>
    `;
   } else {
    div.innerHTML = `
     <div class="day-number">${dia}</div>
     <div class="day-points"></div>
    `;
   }

   fragment.appendChild(div);
  }

  grid.appendChild(fragment);
 },

 /**
  * Esconde o loading overlay
  */
 esconderLoading() {
  if (this.elementos.loadingOverlay) {
   this.elementos.loadingOverlay.classList.add('hidden');
   setTimeout(() => {
    this.elementos.loadingOverlay.style.display = 'none';
   }, 300);
  }
 },

 /**
  * Mostra mensagem de erro
  */
 mostrarErro(erro) {
  this.esconderLoading();
  
  const container = document.getElementById('mainContainer');
  const mensagemErro = document.createElement('div');
  mensagemErro.className = 'error-message';
  mensagemErro.innerHTML = `
   <h3>‚ö†Ô∏è Erro ao Carregar Dados</h3>
   <p>N√£o foi poss√≠vel carregar os dados do dashboard.</p>
   <p style="margin-top:12px;font-size:14px;opacity:0.7">
    Detalhes: ${erro.message}
   </p>
   <button onclick="location.reload()" style="
    margin-top:16px;
    padding:10px 20px;
    background:white;
    color:#991b1b;
    border:none;
    border-radius:8px;
    font-weight:600;
    cursor:pointer;
   ">
    üîÑ Tentar Novamente
   </button>
  `;
  
  container.insertBefore(mensagemErro, container.firstChild);
 }
};

// ============================================
// INICIALIZA√á√ÉO
// ============================================
Dashboard.init();
</script>
</body>
</html>
